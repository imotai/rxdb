{"version":3,"file":"index.js","names":["ERROR_MESSAGES","checkSchema","checkOrmDocumentMethods","checkOrmMethods","checkMigrationStrategies","ensureCollectionNameValid","ensureDatabaseNameIsValid","checkMangoQuery","checkQuery","newRxError","deepFreeze","deepFreezeWhenDevMode","obj","DEV_MODE_PLUGIN_NAME","RxDBDevModePlugin","name","rxdb","overwritable","isDevMode","tunnelErrorMessage","code","console","error","Error","hooks","preCreateRxSchema","after","preCreateRxDatabase","args","preCreateRxCollection","schema","methods","charAt","preCreateRxQuery","prePrepareQuery","createRxCollection","creator","statics","attachments","migrationStrategies"],"sources":["../../../../src/plugins/dev-mode/index.ts"],"sourcesContent":["import type {\n    RxPlugin,\n    RxCollectionCreator,\n    RxDatabaseCreator,\n    RxErrorKey\n} from '../../types';\n\nimport {\n    ERROR_MESSAGES\n} from './error-messages';\nimport {\n    checkSchema\n} from './check-schema';\nimport {\n    checkOrmDocumentMethods,\n    checkOrmMethods\n} from './check-orm';\nimport { checkMigrationStrategies } from './check-migration-strategies';\nimport {\n    ensureCollectionNameValid,\n    ensureDatabaseNameIsValid\n} from './unallowed-properties';\nimport { checkMangoQuery, checkQuery } from './check-query';\nimport { newRxError } from '../../rx-error';\nimport { DeepReadonly } from '../../types/util';\nimport { deepFreeze } from '../../plugins/utils';\n\nexport * from './check-schema';\nexport * from './unallowed-properties';\nexport * from './check-query';\n\n\n/**\n * Deep freezes and object when in dev-mode.\n * Deep-Freezing has the same performaance as deep-cloning, so we only do that in dev-mode.\n * Also we can ensure the readonly state via typescript\n * @link https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze\n */\nexport function deepFreezeWhenDevMode<T>(obj: T): DeepReadonly<T> {\n    // direct return if not suitable for deepFreeze()\n    if (\n        !obj ||\n        typeof obj === 'string' ||\n        typeof obj === 'number'\n    ) {\n        return obj as any;\n    }\n\n    return deepFreeze(obj) as any;\n}\n\n\nexport const DEV_MODE_PLUGIN_NAME = 'dev-mode';\nexport const RxDBDevModePlugin: RxPlugin = {\n    name: DEV_MODE_PLUGIN_NAME,\n    rxdb: true,\n    overwritable: {\n        isDevMode() {\n            return true;\n        },\n        deepFreezeWhenDevMode,\n        tunnelErrorMessage(code: RxErrorKey) {\n            if (!ERROR_MESSAGES[code]) {\n                console.error('RxDB: Error-Code not known: ' + code);\n                throw new Error('Error-Code ' + code + ' not known, contact the maintainer');\n            }\n            return ERROR_MESSAGES[code];\n        }\n    },\n    hooks: {\n        preCreateRxSchema: {\n            after: checkSchema\n        },\n        preCreateRxDatabase: {\n            after: function (args: RxDatabaseCreator<any, any>) {\n                ensureDatabaseNameIsValid(args);\n            }\n        },\n        preCreateRxCollection: {\n            after: function (args: RxCollectionCreator<any> & { name: string; }) {\n                ensureCollectionNameValid(args);\n                checkOrmDocumentMethods(args.schema as any, args.methods);\n                if (args.name.charAt(0) === '_') {\n                    throw newRxError('DB2', {\n                        name: args.name\n                    });\n                }\n                if (!args.schema) {\n                    throw newRxError('DB4', {\n                        name: args.name,\n                        args\n                    });\n                }\n            }\n        },\n        preCreateRxQuery: {\n            after: function (args) {\n                checkQuery(args);\n            }\n        },\n        prePrepareQuery: {\n            after: (args) => {\n                checkMangoQuery(args);\n            }\n        },\n        createRxCollection: {\n            after: (args) => {\n                // check ORM-methods\n                checkOrmMethods(args.creator.statics);\n                checkOrmMethods(args.creator.methods);\n                checkOrmMethods(args.creator.attachments);\n\n                // check migration strategies\n                if (args.creator.schema && args.creator.migrationStrategies) {\n                    checkMigrationStrategies(\n                        args.creator.schema,\n                        args.creator.migrationStrategies\n                    );\n                }\n            }\n        }\n    }\n};\n"],"mappings":"AAOA,SACIA,cAAc,QACX,kBAAkB;AACzB,SACIC,WAAW,QACR,gBAAgB;AACvB,SACIC,uBAAuB,EACvBC,eAAe,QACZ,aAAa;AACpB,SAASC,wBAAwB,QAAQ,8BAA8B;AACvE,SACIC,yBAAyB,EACzBC,yBAAyB,QACtB,wBAAwB;AAC/B,SAASC,eAAe,EAAEC,UAAU,QAAQ,eAAe;AAC3D,SAASC,UAAU,QAAQ,gBAAgB;AAE3C,SAASC,UAAU,QAAQ,qBAAqB;AAEhD,cAAc,gBAAgB;AAC9B,cAAc,wBAAwB;AACtC,cAAc,eAAe;;AAG7B;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,qBAAqB,CAAIC,GAAM,EAAmB;EAC9D;EACA,IACI,CAACA,GAAG,IACJ,OAAOA,GAAG,KAAK,QAAQ,IACvB,OAAOA,GAAG,KAAK,QAAQ,EACzB;IACE,OAAOA,GAAG;EACd;EAEA,OAAOF,UAAU,CAACE,GAAG,CAAC;AAC1B;AAGA,OAAO,IAAMC,oBAAoB,GAAG,UAAU;AAC9C,OAAO,IAAMC,iBAA2B,GAAG;EACvCC,IAAI,EAAEF,oBAAoB;EAC1BG,IAAI,EAAE,IAAI;EACVC,YAAY,EAAE;IACVC,SAAS,uBAAG;MACR,OAAO,IAAI;IACf,CAAC;IACDP,qBAAqB,EAArBA,qBAAqB;IACrBQ,kBAAkB,8BAACC,IAAgB,EAAE;MACjC,IAAI,CAACpB,cAAc,CAACoB,IAAI,CAAC,EAAE;QACvBC,OAAO,CAACC,KAAK,CAAC,8BAA8B,GAAGF,IAAI,CAAC;QACpD,MAAM,IAAIG,KAAK,CAAC,aAAa,GAAGH,IAAI,GAAG,oCAAoC,CAAC;MAChF;MACA,OAAOpB,cAAc,CAACoB,IAAI,CAAC;IAC/B;EACJ,CAAC;EACDI,KAAK,EAAE;IACHC,iBAAiB,EAAE;MACfC,KAAK,EAAEzB;IACX,CAAC;IACD0B,mBAAmB,EAAE;MACjBD,KAAK,EAAE,eAAUE,IAAiC,EAAE;QAChDtB,yBAAyB,CAACsB,IAAI,CAAC;MACnC;IACJ,CAAC;IACDC,qBAAqB,EAAE;MACnBH,KAAK,EAAE,eAAUE,IAAkD,EAAE;QACjEvB,yBAAyB,CAACuB,IAAI,CAAC;QAC/B1B,uBAAuB,CAAC0B,IAAI,CAACE,MAAM,EAASF,IAAI,CAACG,OAAO,CAAC;QACzD,IAAIH,IAAI,CAACb,IAAI,CAACiB,MAAM,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;UAC7B,MAAMvB,UAAU,CAAC,KAAK,EAAE;YACpBM,IAAI,EAAEa,IAAI,CAACb;UACf,CAAC,CAAC;QACN;QACA,IAAI,CAACa,IAAI,CAACE,MAAM,EAAE;UACd,MAAMrB,UAAU,CAAC,KAAK,EAAE;YACpBM,IAAI,EAAEa,IAAI,CAACb,IAAI;YACfa,IAAI,EAAJA;UACJ,CAAC,CAAC;QACN;MACJ;IACJ,CAAC;IACDK,gBAAgB,EAAE;MACdP,KAAK,EAAE,eAAUE,IAAI,EAAE;QACnBpB,UAAU,CAACoB,IAAI,CAAC;MACpB;IACJ,CAAC;IACDM,eAAe,EAAE;MACbR,KAAK,EAAE,eAACE,IAAI,EAAK;QACbrB,eAAe,CAACqB,IAAI,CAAC;MACzB;IACJ,CAAC;IACDO,kBAAkB,EAAE;MAChBT,KAAK,EAAE,eAACE,IAAI,EAAK;QACb;QACAzB,eAAe,CAACyB,IAAI,CAACQ,OAAO,CAACC,OAAO,CAAC;QACrClC,eAAe,CAACyB,IAAI,CAACQ,OAAO,CAACL,OAAO,CAAC;QACrC5B,eAAe,CAACyB,IAAI,CAACQ,OAAO,CAACE,WAAW,CAAC;;QAEzC;QACA,IAAIV,IAAI,CAACQ,OAAO,CAACN,MAAM,IAAIF,IAAI,CAACQ,OAAO,CAACG,mBAAmB,EAAE;UACzDnC,wBAAwB,CACpBwB,IAAI,CAACQ,OAAO,CAACN,MAAM,EACnBF,IAAI,CAACQ,OAAO,CAACG,mBAAmB,CACnC;QACL;MACJ;IACJ;EACJ;AACJ,CAAC"}