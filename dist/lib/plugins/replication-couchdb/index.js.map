{"version":3,"file":"index.js","names":["RxCouchDBReplicationState","url","fetch","replicationIdentifierHash","collection","pull","push","live","retryTime","autoStart","RxReplicationState","syncCouchDB","options","flatClone","endsWith","waitForLeadership","pullStream$","Subject","replicationPrimitivesPull","handler","lastPulledCheckpoint","batchSize","mergeUrlQueryParams","style","feed","include_docs","since","sequence","heartbeat","limit","seq_interval","replicationState","response","json","jsonResponse","documents","results","map","row","couchDBDocToRxDocData","schema","primaryPath","ensureNotFalsy","doc","checkpoint","last_seq","modifier","stream$","asObservable","replicationPrimitivesPush","rows","body","docs","sendDoc","newDocumentState","assumedMasterState","_rev","couchSwapPrimaryToId","method","headers","JSON","stringify","responseJson","conflicts","filter","isConflict","error","ok","newRxError","args","length","getConflictDocsUrl","keys","c","id","conflictResponse","conflictResponseJson","conflictDocsMasterState","r","getDefaultFetch","COUCHDB_NEW_REPLICATION_PLUGIN_IDENTITY_PREFIX","fastUnsecureHash","startBefore","start","bind","isStopped","errorToPlainJson","promiseWait","next","startReplicationOnLeaderShip","RxDBReplicationCouchDBPlugin","name","init","addRxPlugin","RxDBLeaderElectionPlugin","rxdb","prototypes","RxCollection","proto"],"sources":["../../../../src/plugins/replication-couchdb/index.ts"],"sourcesContent":["/**\n * this plugin adds the RxCollection.syncCouchDB()-function to rxdb\n * you can use it to sync collections with a remote CouchDB endpoint.\n */\nimport {\n    ensureNotFalsy,\n    errorToPlainJson,\n    fastUnsecureHash,\n    flatClone\n} from '../../plugins/utils';\n\nimport { RxDBLeaderElectionPlugin } from '../leader-election';\nimport type {\n    RxCollection,\n    RxPlugin,\n    ReplicationPullOptions,\n    ReplicationPushOptions,\n    RxReplicationWriteToMasterRow,\n    RxReplicationPullStreamItem,\n    CouchdbChangesResult,\n    CouchBulkDocResultRow,\n    CouchAllDocsResponse\n} from '../../types';\nimport {\n    RxReplicationState, startReplicationOnLeaderShip\n} from '../replication';\nimport {\n    addRxPlugin,\n    newRxError,\n    WithDeleted\n} from '../../index';\n\nimport { Subject } from 'rxjs';\nimport type {\n    CouchDBCheckpointType,\n    FetchMethodType,\n    SyncOptionsCouchDB\n} from './couchdb-types';\nimport {\n    couchDBDocToRxDocData,\n    COUCHDB_NEW_REPLICATION_PLUGIN_IDENTITY_PREFIX,\n    mergeUrlQueryParams,\n    couchSwapPrimaryToId,\n    getDefaultFetch\n} from './couchdb-helper';\n\nexport * from './couchdb-helper';\nexport * from './couchdb-types';\n\nexport class RxCouchDBReplicationState<RxDocType> extends RxReplicationState<RxDocType, CouchDBCheckpointType> {\n    constructor(\n        public readonly url: string,\n        public fetch: FetchMethodType,\n        public readonly replicationIdentifierHash: string,\n        public readonly collection: RxCollection<RxDocType>,\n        public readonly pull?: ReplicationPullOptions<RxDocType, CouchDBCheckpointType>,\n        public readonly push?: ReplicationPushOptions<RxDocType>,\n        public readonly live: boolean = true,\n        public retryTime: number = 1000 * 5,\n        public autoStart: boolean = true\n    ) {\n        super(\n            replicationIdentifierHash,\n            collection,\n            '_deleted',\n            pull,\n            push,\n            live,\n            retryTime,\n            autoStart\n        );\n    }\n}\n\nexport function syncCouchDB<RxDocType>(\n    this: RxCollection<RxDocType>,\n    options: SyncOptionsCouchDB<RxDocType>\n) {\n    options = flatClone(options);\n    if (!options.url.endsWith('/')) {\n        options.url = options.url + '/';\n    }\n    options.waitForLeadership = typeof options.waitForLeadership === 'undefined' ? true : options.waitForLeadership;\n\n    const collection = this;\n    const pullStream$: Subject<RxReplicationPullStreamItem<RxDocType, CouchDBCheckpointType>> = new Subject();\n    let replicationPrimitivesPull: ReplicationPullOptions<RxDocType, CouchDBCheckpointType> | undefined;\n    if (options.pull) {\n        replicationPrimitivesPull = {\n            async handler(\n                lastPulledCheckpoint: CouchDBCheckpointType | undefined,\n                batchSize: number\n            ) {\n                /**\n                 * @link https://docs.couchdb.org/en/3.2.2-docs/api/database/changes.html\n                 */\n                const url = options.url + '_changes?' + mergeUrlQueryParams({\n                    style: 'all_docs',\n                    feed: 'normal',\n                    include_docs: true,\n                    since: lastPulledCheckpoint ? lastPulledCheckpoint.sequence : 0,\n                    heartbeat: options.pull && options.pull.heartbeat ? options.pull.heartbeat : 60000,\n                    limit: batchSize,\n                    seq_interval: batchSize\n                });\n\n                const response = await replicationState.fetch(url);\n                const jsonResponse: CouchdbChangesResult = await response.json();\n                const documents: WithDeleted<RxDocType>[] = jsonResponse.results\n                    .map(row => couchDBDocToRxDocData(collection.schema.primaryPath, ensureNotFalsy(row.doc)));\n                return {\n                    documents,\n                    checkpoint: {\n                        sequence: jsonResponse.last_seq\n                    }\n                };\n            },\n            batchSize: ensureNotFalsy(options.pull).batchSize,\n            modifier: ensureNotFalsy(options.pull).modifier,\n            stream$: pullStream$.asObservable()\n        };\n    }\n\n    let replicationPrimitivesPush: ReplicationPushOptions<RxDocType> | undefined;\n    if (options.push) {\n        replicationPrimitivesPush = {\n            async handler(\n                rows: RxReplicationWriteToMasterRow<RxDocType>[]\n            ) {\n                /**\n                 * @link https://docs.couchdb.org/en/3.2.2-docs/api/database/bulk-api.html#db-bulk-docs\n                 */\n                const url = options.url + '_bulk_docs?' + mergeUrlQueryParams({});\n                const body = {\n                    docs: rows.map(row => {\n                        const sendDoc = flatClone(row.newDocumentState);\n                        if (row.assumedMasterState) {\n                            (sendDoc as any)._rev = ensureNotFalsy((row.assumedMasterState as any)._rev);\n                        }\n                        return couchSwapPrimaryToId(collection.schema.primaryPath, sendDoc);\n                    })\n                };\n\n                const response = await replicationState.fetch(\n                    url,\n                    {\n                        method: 'POST',\n                        headers: {\n                            'content-type': 'application/json'\n                        },\n                        body: JSON.stringify(body)\n                    }\n                );\n                const responseJson: CouchBulkDocResultRow[] = await response.json();\n\n                const conflicts = responseJson.filter(row => {\n                    const isConflict = row.error === 'conflict';\n                    if (!row.ok && !isConflict) {\n                        throw newRxError('SNH', { args: { row } });\n                    }\n                    return isConflict;\n                });\n\n                if (conflicts.length === 0) {\n                    return [];\n                }\n\n                const getConflictDocsUrl = options.url + '_all_docs?' + mergeUrlQueryParams({\n                    include_docs: true,\n                    keys: JSON.stringify(conflicts.map(c => c.id))\n                });\n                const conflictResponse = await replicationState.fetch(getConflictDocsUrl);\n                const conflictResponseJson: CouchAllDocsResponse = await conflictResponse.json();\n                const conflictDocsMasterState: WithDeleted<RxDocType>[] = conflictResponseJson.rows\n                    .map(r => couchDBDocToRxDocData(collection.schema.primaryPath, r.doc));\n\n                return conflictDocsMasterState;\n            },\n            batchSize: options.push.batchSize,\n            modifier: options.push.modifier\n        };\n    }\n\n    const replicationState = new RxCouchDBReplicationState<RxDocType>(\n        options.url,\n        options.fetch ? options.fetch : getDefaultFetch(),\n        COUCHDB_NEW_REPLICATION_PLUGIN_IDENTITY_PREFIX + fastUnsecureHash(options.url),\n        collection,\n        replicationPrimitivesPull,\n        replicationPrimitivesPush,\n        options.live,\n        options.retryTime,\n        options.autoStart\n    );\n\n    /**\n     * Use long polling to get live changes for the pull.stream$\n     */\n    if (options.live && options.pull) {\n        const startBefore = replicationState.start.bind(replicationState);\n        replicationState.start = () => {\n            let since: string | number = 'now';\n            const batchSize = options.pull && options.pull.batchSize ? options.pull.batchSize : 20;\n\n            (async () => {\n                while (!replicationState.isStopped()) {\n                    const url = options.url + '_changes?' + mergeUrlQueryParams({\n                        style: 'all_docs',\n                        feed: 'longpoll',\n                        since,\n                        include_docs: true,\n                        heartbeat: options.pull && options.pull.heartbeat ? options.pull.heartbeat : 60000,\n                        limit: batchSize,\n                        seq_interval: batchSize\n                    });\n\n                    let jsonResponse: CouchdbChangesResult;\n                    try {\n                        jsonResponse = await (await replicationState.fetch(url)).json();\n                    } catch (err: any) {\n                        pullStream$.error(newRxError('RC_STREAM', {\n                            args: { url },\n                            error: errorToPlainJson(err)\n                        }));\n                        // await next tick here otherwise we could go in to a 100% CPU blocking cycle.\n                        await this.promiseWait(0);\n                        continue;\n                    }\n                    const documents: WithDeleted<RxDocType>[] = jsonResponse.results\n                        .map(row => couchDBDocToRxDocData(collection.schema.primaryPath, ensureNotFalsy(row.doc)));\n                    since = jsonResponse.last_seq;\n\n                    pullStream$.next({\n                        documents,\n                        checkpoint: {\n                            sequence: jsonResponse.last_seq\n                        }\n                    });\n                }\n            })();\n            return startBefore();\n        };\n    }\n\n    startReplicationOnLeaderShip(options.waitForLeadership, replicationState);\n\n    return replicationState;\n}\n\n\nexport const RxDBReplicationCouchDBPlugin: RxPlugin = {\n    name: 'replication-couchdb',\n    init() {\n        addRxPlugin(RxDBLeaderElectionPlugin);\n    },\n    rxdb: true,\n    prototypes: {\n        RxCollection: (proto: any) => {\n            proto.syncCouchDB = syncCouchDB;\n        }\n    }\n};\n"],"mappings":"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"}