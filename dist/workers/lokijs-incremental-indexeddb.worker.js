(()=>{var t={5643:t=>{t.exports=!1},6898:t=>{"use strict";t.exports=t=>!!t&&("symbol"==typeof Symbol.observable&&"function"==typeof t[Symbol.observable]?t===t[Symbol.observable]():"function"==typeof t["@@observable"]&&t===t["@@observable"]())},8930:function(t,e){var n,r,i;r=[],void 0===(i="function"==typeof(n=function(){return function(){"use strict";var t="undefined"!=typeof window&&!!window.__loki_incremental_idb_debug;function e(t){if(this.mode="incremental",this.options=t||{},this.chunkSize=100,this.megachunkCount=this.options.megachunkCount||20,this.idb=null,this._prevLokiVersionId=null,this._prevCollectionVersionIds={},!(this.megachunkCount>=4&&this.megachunkCount%2==0))throw new Error("megachunkCount must be >=4 and divisible by 2")}function n(t){var e={};return t.forEach((function(t){var n=t.split(".");if(3===n.length&&"chunk"===n[1]){var r=n[0],i=parseInt(n[2])||0,o=e[r];(!o||i>o)&&(e[r]=i)}})),e}function r(t){try{return t&&JSON.parse(t.value).idbVersionId||null}catch(t){return console.error("Error while parsing loki chunk",t),null}}function i(t){var e,n={};if(c(t),t.forEach((function(t){var r=t.key,i=t.value;if("loki"!==r){if(r.includes(".")){var o=r.split(".");if(3===o.length&&"chunk"===o[1]){var s=o[0];return void(n[s]?n[s].dataChunks.push(i):n[s]={metadata:null,dataChunks:[i]})}if(2===o.length&&"metadata"===o[1]){var a=o[0];return void(n[a]?n[a].metadata=i:n[a]={metadata:i,dataChunks:[]})}}throw console.error("Unknown chunk "+r),new Error("Corrupted database - unknown chunk found")}e=i})),!e)throw new Error("Corrupted database - missing database metadata");return{loki:e,chunkMap:n}}function o(t,e){t.collections.forEach((function(n,r){var i=e[n.name];if(i){if(!i.metadata)throw new Error("Corrupted database - missing metadata chunk for "+n.name);var o=i.metadata;i.metadata=null,t.collections[r]=o;var s=i.dataChunks;s.forEach((function(t,e){t.forEach((function(t){o.data.push(t)})),s[e]=null}))}}))}function s(t,e){if(t.value=JSON.parse(t.value),e){var n=t.key.split(".");if(3===n.length&&"chunk"===n[1]){var r=n[0];t.value=e(r,t.value)}}}function a(){return Math.random().toString(36).substring(2)}function u(t){var e=t.key;if(e.includes(".")){var n=e.split(".");if(3===n.length&&"chunk"===n[1])return parseInt(n[2],10)}return-1}function c(t){t.sort((function(t,e){var n=u(t),r=u(e);return n<r?-1:n>r?1:0}))}function l(t,e){for(var n,r,i=Math.floor(t.length/e),o=[],s=0;s<e;s+=1)n=t[i*s],r=t[i*(s+1)],0===s?o.push(IDBKeyRange.upperBound(r,!0)):s===e-1?o.push(IDBKeyRange.lowerBound(n)):o.push(IDBKeyRange.bound(n,r,!1,!0));return o}function h(t,e,n){return t.onsuccess=function(t){try{return e(t)}catch(t){n(t)}},t.onerror=n,t}return e.prototype._getChunk=function(t,e){var n=e*this.chunkSize,r=n+this.chunkSize-1;t.ensureId();for(var i,o=t.idIndex,s=null,a=o.length-1,u=0;o[u]<o[a];)o[i=u+a>>1]<n?u=i+1:a=i;if(a===u&&o[u]>=n&&o[u]<=r&&(s=u),null===s)return[];for(var c=null,l=s+this.chunkSize-1;l>=s;l--)if(o[l]<=r){c=l;break}var h=t.data[s];if(!(h&&h.$loki>=n&&h.$loki<=r))throw new Error("broken invariant firstelement");var f=t.data[c];if(!(f&&f.$loki>=n&&f.$loki<=r))throw new Error("broken invariant lastElement");var d=t.data.slice(s,c+1);if(d.length>this.chunkSize)throw new Error("broken invariant - chunk size");return d},e.prototype.saveDatabase=function(e,i,o){var s=this;if(this.idb){if(this.operationInProgress)throw new Error("Error while saving to database - another operation is already in progress. Please use throttledSaves=true option on Loki object");this.operationInProgress=!0,t&&console.log("saveDatabase - begin"),t&&console.time("saveDatabase");try{var a=function(){console.error("Unexpected successful tx - cannot update previous version ids")},u=!1,c=this.idb.transaction(["LokiIncrementalData"],"readwrite");c.oncomplete=function(){a(),p(),u&&s.options.onDidOverwrite&&s.options.onDidOverwrite()},c.onerror=function(t){p(t)},c.onabort=function(t){p(t)};var l=c.objectStore("LokiIncrementalData"),f=function(t){try{var e=!t,n=s._putInChunks(l,i(),e,t);a=function(){s._prevLokiVersionId=n.lokiVersionId,n.collectionVersionIds.forEach((function(t){s._prevCollectionVersionIds[t.name]=t.versionId}))},c.commit&&c.commit()}catch(t){console.error("idb performSave failed: ",t),c.abort()}},d=function(){h(l.getAllKeys(),(function(t){var e=n(t.target.result);f(e)}),(function(t){console.error("Getting all keys failed: ",t),c.abort()}))};h(l.get("loki"),(function(e){r(e.target.result)===s._prevLokiVersionId?f():(t&&console.warn("Another writer changed Loki IDB, using slow path..."),u=!0,d())}),(function(t){console.error("Getting loki chunk failed: ",t),c.abort()}))}catch(t){p(t)}}else this._initializeIDB(e,o,(function(){s.saveDatabase(e,i,o)}));function p(e){t&&e&&console.error(e),t&&console.timeEnd("saveDatabase"),s.operationInProgress=!1,o(e)}},e.prototype._putInChunks=function(e,n,r,i){var o=this,s=[],u=0,c=function(c,l){var h=new Set;r&&c.dirtyIds.forEach((function(t){var e=t/o.chunkSize|0;h.add(e)})),c.dirtyIds=[];var f=function(n){var i=o._getChunk(c,n);o.options.serializeChunk&&(i=o.options.serializeChunk(c.name,i)),i=JSON.stringify(i),u+=i.length,t&&r&&console.log("Saving: "+c.name+".chunk."+n),e.put({key:c.name+".chunk."+n,value:i})};if(r)h.forEach(f);else{for(var d=c.maxId/o.chunkSize|0,p=0;p<=d;p+=1)f(p);for(var y=i[c.name]||0,v=d+1;v<=y;v+=1){var m=c.name+".chunk."+v;e.delete(m),t&&console.warn("Deleted chunk: "+m)}}if(c.dirty||h.size||!r){c.idIndex=[],c.data=[],c.idbVersionId=a(),s.push({name:c.name,versionId:c.idbVersionId});var b=JSON.stringify(c);u+=b.length,t&&r&&console.log("Saving: "+c.name+".metadata"),e.put({key:c.name+".metadata",value:b})}n.collections[l]={name:c.name}};n.collections.forEach(c),n.idbVersionId=a();var l=JSON.stringify(n);return u+=l.length,t&&r&&console.log("Saving: loki"),e.put({key:"loki",value:l}),t&&console.log("saved size: "+u),{lokiVersionId:n.idbVersionId,collectionVersionIds:s}},e.prototype.loadDatabase=function(e,n){var r=this;if(this.operationInProgress)throw new Error("Error while loading database - another operation is already in progress. Please use throttledSaves=true option on Loki object");this.operationInProgress=!0,t&&console.log("loadDatabase - begin"),t&&console.time("loadDatabase");var s=function(e){t&&console.timeEnd("loadDatabase"),r.operationInProgress=!1,n(e)};this._getAllChunks(e,(function(e){try{if(!Array.isArray(e))throw e;if(!e.length)return s(null);t&&console.log("Found chunks:",e.length);var n=(e=i(e)).loki;return e.loki=null,o(n,e.chunkMap),e=null,r._prevLokiVersionId=n.idbVersionId||null,r._prevCollectionVersionIds={},n.collections.forEach((function(t){r._prevCollectionVersionIds[t.name]=t.idbVersionId||null})),s(n)}catch(t){return r._prevLokiVersionId=null,r._prevCollectionVersionIds={},s(t)}}))},e.prototype._initializeIDB=function(e,n,r){var i=this;if(t&&console.log("initializing idb"),this.idbInitInProgress)throw new Error("Cannot open IndexedDB because open is already in progress");this.idbInitInProgress=!0;var o=indexedDB.open(e,1);o.onupgradeneeded=function(e){var n=e.target.result;if(t&&console.log("onupgradeneeded, old version: "+e.oldVersion),!(e.oldVersion<1))throw new Error("Invalid old version "+e.oldVersion+" for IndexedDB upgrade");n.createObjectStore("LokiIncrementalData",{keyPath:"key"})},o.onsuccess=function(o){i.idbInitInProgress=!1;var s=o.target.result;if(i.idb=s,!s.objectStoreNames.contains("LokiIncrementalData"))return n(new Error("Missing LokiIncrementalData")),void i.deleteDatabase(e);t&&console.log("init success"),s.onversionchange=function(e){i.idb===s&&(t&&console.log("IDB version change",e),i.idb.close(),i.idb=null,i.options.onversionchange&&i.options.onversionchange(e))},r()},o.onblocked=function(t){console.error("IndexedDB open is blocked",t),n(new Error("IndexedDB open is blocked by open connection"))},o.onerror=function(t){i.idbInitInProgress=!1,console.error("IndexedDB open error",t),n(t)}},e.prototype._getAllChunks=function(t,e){var n=this;if(this.idb){var r=this.idb.transaction(["LokiIncrementalData"],"readonly").objectStore("LokiIncrementalData"),i=this.options.deserializeChunk;u()}else this._initializeIDB(t,e,(function(){n._getAllChunks(t,e)}));function o(t){var o=n.megachunkCount,a=l(t,o),u=[],c=0;function f(t,n,r){var a=t.target.result;a.forEach((function(t,e){s(t,i),u.push(t),a[e]=null})),(c+=1)===o&&e(u)}function d(t){var n=a[t];h(r.getAll(n),(function(e){t<o/2&&d(t+o/2),f(e,t,n)}),(function(t){e(t)}))}for(var p=0;p<o/2;p+=1)d(p)}function a(){h(r.getAll(),(function(t){var n=t.target.result;n.forEach((function(t){s(t,i)})),e(n)}),(function(t){e(t)}))}function u(){h(r.getAllKeys(),(function(t){var e=t.target.result.sort();e.length>100?o(e):a()}),(function(t){e(t)})),n.options.onFetchStart&&n.options.onFetchStart()}},e.prototype.deleteDatabase=function(e,n){if(this.operationInProgress)throw new Error("Error while deleting database - another operation is already in progress. Please use throttledSaves=true option on Loki object");this.operationInProgress=!0;var r=this;t&&console.log("deleteDatabase - begin"),t&&console.time("deleteDatabase"),this._prevLokiVersionId=null,this._prevCollectionVersionIds={},this.idb&&(this.idb.close(),this.idb=null);var i=indexedDB.deleteDatabase(e);i.onsuccess=function(){r.operationInProgress=!1,t&&console.timeEnd("deleteDatabase"),n({success:!0})},i.onerror=function(t){r.operationInProgress=!1,console.error("Error while deleting database",t),n({success:!1})},i.onblocked=function(t){console.error("Deleting database failed because it's blocked by another connection",t)}},e}()})?n.apply(e,r):n)||(t.exports=i)},7996:function(t,e){var n,r,i;r=[],void 0===(i="function"==typeof(n=function(){return function(){function t(t,e){if(this.app="loki",this.options=e||{},void 0!==t&&(this.app=t),this.catalog=null,!this.checkAvailability())throw new Error("indexedDB does not seem to be supported for your environment")}function e(t){this.db=null,this.initializeLokiCatalog(t)}return t.prototype.closeDatabase=function(){this.catalog&&this.catalog.db&&(this.catalog.db.close(),this.catalog.db=null)},t.prototype.checkAvailability=function(){return!("undefined"==typeof indexedDB||!indexedDB)},t.prototype.loadDatabase=function(t,n){var r=this.app,i=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(r,t,(function(t){if("function"==typeof n){if(0===t.id)return void n(null);n(t.val)}else console.log(t.val)})):this.catalog=new e((function(e){i.catalog=e,i.loadDatabase(t,n)}))},t.prototype.loadKey=t.prototype.loadDatabase,t.prototype.saveDatabase=function(t,n,r){var i=this.app,o=this;function s(t){t&&!0===t.success?r(null):r(new Error("Error saving database")),o.options.closeAfterSave&&o.closeDatabase()}null!==this.catalog&&null!==this.catalog.db?this.catalog.setAppKey(i,t,n,s):this.catalog=new e((function(e){o.saveDatabase(t,n,s)}))},t.prototype.saveKey=t.prototype.saveDatabase,t.prototype.deleteDatabase=function(t,n){var r=this.app,i=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(r,t,(function(t){var e=t.id;0!==e?i.catalog.deleteAppKey(e,n):"function"==typeof n&&n({success:!0})})):this.catalog=new e((function(e){i.catalog=e,i.deleteDatabase(t,n)}))},t.prototype.deleteKey=t.prototype.deleteDatabase,t.prototype.deleteDatabasePartitions=function(t){var e=this;this.getDatabaseList((function(n){n.forEach((function(n){n.startsWith(t)&&e.deleteDatabase(n)}))}))},t.prototype.getDatabaseList=function(t){var n=this.app,r=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKeys(n,(function(e){for(var n=[],r=0;r<e.length;r++)n.push(e[r].key);"function"==typeof t?t(n):n.forEach((function(t){console.log(t)}))})):this.catalog=new e((function(e){r.catalog=e,r.getDatabaseList(t)}))},t.prototype.getKeyList=t.prototype.getDatabaseList,t.prototype.getCatalogSummary=function(t){this.app;var n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAllKeys((function(e){for(var n,r,i,o,s,a=[],u=0;u<e.length;u++)i=(n=e[u]).app||"",o=n.key||"",s=n.val||"",r=2*i.length+2*o.length+s.length+1,a.push({app:n.app,key:n.key,size:r});"function"==typeof t?t(a):a.forEach((function(t){console.log(t)}))})):this.catalog=new e((function(e){n.catalog=e,n.getCatalogSummary(t)}))},e.prototype.initializeLokiCatalog=function(t){var e=indexedDB.open("LokiCatalog",1),n=this;e.onupgradeneeded=function(t){var e=t.target.result;if(e.objectStoreNames.contains("LokiAKV")&&e.deleteObjectStore("LokiAKV"),!e.objectStoreNames.contains("LokiAKV")){var n=e.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0});n.createIndex("app","app",{unique:!1}),n.createIndex("key","key",{unique:!1}),n.createIndex("appkey","appkey",{unique:!0})}},e.onsuccess=function(e){n.db=e.target.result,"function"==typeof t&&t(n)},e.onerror=function(t){throw t}},e.prototype.getAppKey=function(t,e,n){var r,i=t+","+e,o=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("appkey").get(i);o.onsuccess=(r=n,function(t){var e=t.target.result;null==e&&(e={id:0,success:!1}),"function"==typeof r?r(e):console.log(e)}),o.onerror=function(t){return function(e){if("function"!=typeof t)throw e;t({id:0,success:!1})}}(n)},e.prototype.getAppKeyById=function(t,e,n){this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").get(t).onsuccess=function(t,e){return function(n){"function"==typeof e?e(n.target.result,t):console.log(n.target.result)}}(n,e)},e.prototype.setAppKey=function(t,e,n,r){var i,o=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV"),s=o.index("appkey"),a=t+","+e,u=s.get(a);u.onsuccess=function(i){var s=i.target.result;null==s?s={app:t,key:e,appkey:t+","+e,val:n}:s.val=n;var a,c=o.put(s);c.onerror=(a=r,function(t){"function"==typeof a?a({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(u.error))}),c.onsuccess=function(t){return function(e){"function"==typeof t&&t({success:!0})}}(r)},u.onerror=(i=r,function(t){"function"==typeof i?i({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(u.error))})},e.prototype.deleteAppKey=function(t,e){var n,r=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV").delete(t);r.onsuccess=(n=e,function(t){"function"==typeof n&&n({success:!0})}),r.onerror=function(t){return function(e){"function"==typeof t?t({success:!1}):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(r.error))}}(e)},e.prototype.getAppKeys=function(t,e){var n,r=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("app"),i=IDBKeyRange.only(t),o=r.openCursor(i),s=[];o.onsuccess=function(t,e){return function(n){var r=n.target.result;if(r){var i=r.value;t.push(i),r.continue()}else"function"==typeof e?e(t):console.log(t)}}(s,e),o.onerror=(n=e,function(t){"function"==typeof n?n(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(t))})},e.prototype.getAllKeys=function(t){var e,n=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").openCursor(),r=[];n.onsuccess=function(t,e){return function(n){var r=n.target.result;if(r){var i=r.value;t.push(i),r.continue()}else"function"==typeof e?e(t):console.log(t)}}(r,t),n.onerror=(e=t,function(t){"function"==typeof e&&e(null)})},t}()})?n.apply(e,r):n)||(t.exports=i)},3050:function(t,e,n){var r,i,o;i=[],r=function(){return function(){"use strict";var t=Object.prototype.hasOwnProperty;function e(t){var n,i;if(Array.isArray(t)){for(i=0;i<t.length;i++)e(t[i]);r(t)}else if(null!==t&&"object"==typeof t){for(n in t)t.hasOwnProperty(n)&&e(t[n]);r(t)}}function r(t){Object.isFrozen(t)||Object.freeze(t)}function i(t){return Object.isFrozen(t)?m(t,"shallow"):t}var o={copyProperties:function(t,e){var n;for(n in t)e[n]=t[n]},resolveTransformObject:function(t,e,n){var r,i;if("number"!=typeof n&&(n=0),++n>=10)return t;for(r in t)"string"==typeof t[r]&&0===t[r].indexOf("[%lktxp]")?(i=t[r].substring(8),e.hasOwnProperty(i)&&(t[r]=e[i])):"object"==typeof t[r]&&(t[r]=o.resolveTransformObject(t[r],e,n));return t},resolveTransformParams:function(t,e){var n,r,i=[];if(void 0===e)return t;for(n=0;n<t.length;n++)r=m(t[n],"shallow-recurse-objects"),i.push(o.resolveTransformObject(r,e));return i},getIn:function(t,e,n){if(null!=t){if(!n)return t[e];if("string"==typeof e&&(e=e.split(".")),!Array.isArray(e))throw new Error("path must be a string or array. Found "+typeof e);for(var r=0,i=e.length;null!=t&&r<i;)t=t[e[r++]];return r&&r==i?t:void 0}}},s={aeq:a,lt:u,gt:c};function a(t,e){var n,r,i,o;if(t===e)return!0;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:i=1;break;case!1:i=3;break;case!0:i=4;break;case"":i=5;break;default:i=t==t?9:0}switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}if(9!==i||9!==o)return i===o}return n=Number(t),r=Number(e),n==n||r==r?n===r:(n=t.toString())==(r=e.toString())}function u(t,e,n){var r,i,o,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==o||9!==s)return o===s?n:o<s}return r=Number(t),i=Number(e),r==r&&i==i?r<i||!(r>i)&&n:r==r&&i!=i||(i!=i||r==r)&&(t<e||!(t>e)&&(t==e?n:(r=t.toString())<(i=e.toString())||r==i&&n))}function c(t,e,n){var r,i,o,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==o||9!==s)return o===s?n:o>s}return r=Number(t),i=Number(e),r==r&&i==i?r>i||!(r<i)&&n:(r!=r||i==i)&&(i==i&&r!=r||t>e||!(t<e)&&(t==e?n:(r=t.toString())>(i=e.toString())||r==i&&n))}function l(t,e,n){return s.aeq(t,e)?0:s.lt(t,e,!1)?n?1:-1:s.gt(t,e,!1)?n?-1:1:0}function h(t,e,n){for(var r,i,s,a,u,c=0,h=0,f=t.length;h<f;h++)if(~(i=(r=t[h])[0]).indexOf(".")?(u=i.split("."),s=o.getIn(e,u,!0),a=o.getIn(n,u,!0)):(s=e[i],a=n[i]),0!==(c=l(s,a,r[1])))return c;return 0}function f(t,e,n,r,i,o){var s,a=o||0,u=e[a],c=!1;if("object"==typeof t&&u in t&&(s=t[u]),a+1>=e.length)c=n(s,r,i);else if(Array.isArray(s))for(var l=0,h=s.length;l<h&&!0!==(c=f(s[l],e,n,r,i,a+1));l+=1);else c=f(s,e,n,r,i,a+1);return c}function d(e){return"string"==typeof e||Array.isArray(e)?function(t){return-1!==e.indexOf(t)}:"object"==typeof e&&null!==e?function(n){return t.call(e,n)}:null}function p(e,n,r){for(var i in n)if(t.call(n,i))return y[i](e,n[i],r);return!1}var y={$eq:function(t,e){return t===e},$aeq:function(t,e){return t==e},$ne:function(t,e){return e!=e?t==t:t!==e},$dteq:function(t,e){return s.aeq(t,e)},$gt:function(t,e){return s.gt(t,e,!1)},$gte:function(t,e){return s.gt(t,e,!0)},$lt:function(t,e){return s.lt(t,e,!1)},$lte:function(t,e){return s.lt(t,e,!0)},$jgt:function(t,e){return t>e},$jgte:function(t,e){return t>=e},$jlt:function(t,e){return t<e},$jlte:function(t,e){return t<=e},$between:function(t,e){return null!=t&&s.gt(t,e[0],!0)&&s.lt(t,e[1],!0)},$jbetween:function(t,e){return null!=t&&t>=e[0]&&t<=e[1]},$in:function(t,e){return-1!==e.indexOf(t)},$inSet:function(t,e){return e.has(t)},$nin:function(t,e){return-1===e.indexOf(t)},$keyin:function(t,e){return t in e},$nkeyin:function(t,e){return!(t in e)},$definedin:function(t,e){return void 0!==e[t]},$undefinedin:function(t,e){return void 0===e[t]},$regex:function(t,e){return e.test(t)},$containsString:function(t,e){return"string"==typeof t&&-1!==t.indexOf(e)},$containsNone:function(t,e){return!y.$containsAny(t,e)},$containsAny:function(t,e){var n=d(t);return null!==n&&(Array.isArray(e)?e.some(n):n(e))},$contains:function(t,e){var n=d(t);return null!==n&&(Array.isArray(e)?e.every(n):n(e))},$elemMatch:function(t,e){return!!Array.isArray(t)&&t.some((function(t){return Object.keys(e).every((function(n){var r=e[n];return"object"==typeof r&&r||(r={$eq:r}),-1!==n.indexOf(".")?f(t,n.split("."),p,e[n],t):p(t[n],r,t)}))}))},$type:function(t,e,n){var r=typeof t;return"object"===r&&(Array.isArray(t)?r="array":t instanceof Date&&(r="date")),"object"!=typeof e?r===e:p(r,e,n)},$finite:function(t,e){return e===isFinite(t)},$size:function(t,e,n){return!!Array.isArray(t)&&("object"!=typeof e?t.length===e:p(t.length,e,n))},$len:function(t,e,n){return"string"==typeof t&&("object"!=typeof e?t.length===e:p(t.length,e,n))},$where:function(t,e){return!0===e(t)},$not:function(t,e,n){return!p(t,e,n)},$and:function(t,e,n){for(var r=0,i=e.length;r<i;r+=1)if(!p(t,e[r],n))return!1;return!0},$or:function(t,e,n){for(var r=0,i=e.length;r<i;r+=1)if(p(t,e[r],n))return!0;return!1},$exists:function(t,e){return e?void 0!==t:void 0===t}};["$eq","$aeq","$ne","$dteq","$gt","$gte","$lt","$lte","$jgt","$jgte","$jlt","$jlte","$type"].forEach((function(t){var e=y[t];y["$"+t]=function(t,n,r){if("string"==typeof n)return e(t,r[n]);if("function"==typeof n)return e(t,n(r));throw new Error("Invalid argument to $$ matcher")}}));var v={$eq:y.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0};function m(t,e){if(null==t)return null;var n;switch(e||"parse-stringify"){case"parse-stringify":n=JSON.parse(JSON.stringify(t));break;case"jquery-extend-deep":n=jQuery.extend(!0,{},t);break;case"shallow":n=Object.create(t.constructor.prototype),Object.keys(t).map((function(e){n[e]=t[e]}));break;case"shallow-assign":n=Object.create(t.constructor.prototype),Object.assign(n,t);break;case"shallow-recurse-objects":n=m(t,"shallow"),Object.keys(t).forEach((function(e){"object"==typeof t[e]&&"Object"===t[e].constructor.name?n[e]=m(t[e],"shallow-recurse-objects"):Array.isArray(t[e])&&(n[e]=b(t[e],"shallow-recurse-objects"))}))}return n}function b(t,e){if("parse-stringify"==e)return m(t,e);for(var n=[],r=0,i=t.length;r<i;r++)n[r]=m(t[r],e);return n}function g(){try{return window&&void 0!==window.localStorage&&null!==window.localStorage}catch(t){return!1}}function w(){}function I(t,e){this.filename=t||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=!(!e||!e.hasOwnProperty("verbose"))&&e.verbose,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]};var r=function(){return void 0!==n.g&&(n.g.android||n.g.NSObject)?"NATIVESCRIPT":"undefined"==typeof window||void 0!==n.g&&n.g.window&&"undefined"!=typeof process?"NODEJS":"undefined"!=typeof document?-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER":"CORDOVA"};e&&e.hasOwnProperty("env")?this.ENV=e.env:this.ENV=r(),"undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(e,!0),this.on("init",this.clearChanges)}function k(t){this.hashStore={},this.options=t||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}function x(t,e){if(this.mode="reference",this.adapter=null,this.options=e||{},this.dbref=null,this.dbname="",this.pageIterator={},!t)throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");if("reference"===t.mode)throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=t,this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=26214400),this.options.hasOwnProperty("delimiter")||(this.options.delimiter="$<\n")}function S(){try{this.fs=n(693)}catch(t){this.fs=null}}function O(){}function P(t,e){return e=e||{},this.collection=t,this.filteredrows=[],this.filterInitialized=!1,this}function D(t,e){if("$regex"===t)Array.isArray(e)?e=new RegExp(e[0],e[1]):e instanceof RegExp||(e=new RegExp(e));else if("object"==typeof e)for(var n in e)"$regex"!==n&&"object"!=typeof e[n]||(e[n]=D(n,e[n]));return e}function E(t,e,n){this.collection=t,this.name=e,this.rebuildPending=!1,this.options=n||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.options.hasOwnProperty("minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new P(t),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.collection.disableFreeze||Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[],filter:[],sort:[]}}function C(e,n){this.name=e,this.data=[],this.idIndex=null,this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var r=this;(n=n||{}).hasOwnProperty("unique")&&(Array.isArray(n.unique)||(n.unique=[n.unique]),n.unique.forEach((function(t){r.uniqueNames.push(t)}))),n.hasOwnProperty("exact")&&n.exact.forEach((function(t){r.constraints.exact[t]=new F(t)})),this.adaptiveBinaryIndices=!n.hasOwnProperty("adaptiveBinaryIndices")||n.adaptiveBinaryIndices,this.transactional=!!n.hasOwnProperty("transactional")&&n.transactional,this.cloneObjects=!!n.hasOwnProperty("clone")&&n.clone,this.cloneMethod=n.hasOwnProperty("cloneMethod")?n.cloneMethod:"parse-stringify",this.asyncListeners=!!n.hasOwnProperty("asyncListeners")&&n.asyncListeners,this.disableMeta=!!n.hasOwnProperty("disableMeta")&&n.disableMeta,this.disableChangesApi=!n.hasOwnProperty("disableChangesApi")||n.disableChangesApi,this.disableDeltaChangesApi=!n.hasOwnProperty("disableDeltaChangesApi")||n.disableDeltaChangesApi,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=!!n.hasOwnProperty("autoupdate")&&n.autoupdate,this.serializableIndices=!n.hasOwnProperty("serializableIndices")||n.serializableIndices,this.disableFreeze=!n.hasOwnProperty("disableFreeze")||n.disableFreeze,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(n.ttl||-1,n.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.dirtyIds=[];var i=[];if(n&&n.indices)if("[object Array]"===Object.prototype.toString.call(n.indices))i=n.indices;else{if("string"!=typeof n.indices)throw new TypeError("Indices needs to be a string or an array of strings");i=[n.indices]}for(var o=0;o<i.length;o++)this.ensureIndex(i[o]);function s(e){var n="function"==typeof Set?new Set:[];n.add||(n.add=function(t){return-1===this.indexOf(t)&&this.push(t),this}),e.forEach((function(t){n.add(t.object)})),n.forEach((function(e){if(!t.call(e,"$loki"))return r.removeAutoUpdateObserver(e);try{r.update(e)}catch(t){}}))}function a(t,e){return e?u(e,t):JSON.parse(JSON.stringify(t))}function u(t,e){var n=null!==e&&"object"==typeof e?Object.keys(e):null;if(n&&n.length&&["string","boolean","number"].indexOf(typeof e)<0){for(var i={},o=0;o<n.length;o++){var s=n[o];if(e.hasOwnProperty(s))if(!t.hasOwnProperty(s)||r.uniqueNames.indexOf(s)>=0||"$loki"==s||"meta"==s)i[s]=e[s];else{var a=u(t[s],e[s]);void 0!==a&&a!={}&&(i[s]=a)}}return 0===Object.keys(i).length?void 0:i}return t===e?void 0:e}function c(){r.changes=[]}this.observerCallback=s,this.getChangeDelta=a,this.getObjectDelta=u,this.getChanges=function(){return r.changes},this.flushChanges=c,this.setChangesApi=function(t){r.disableChangesApi=!t,t||(r.disableDeltaChangesApi=!1)},this.on("delete",(function(t){r.disableChangesApi||r.createChange(r.name,"R",t)})),this.on("warning",(function(t){r.lokiConsoleWrapper.warn(t)})),c()}function _(t){return-1!==t.indexOf(".")}function j(t){return parseFloat(t,10)}function A(t,e){return t+e}function M(t,e){return t-e}function L(t){return t.reduce(A,0)/t.length}function z(t){var e=L(t),n=L(t.map((function(t){var n=t-e;return n*n})));return Math.sqrt(n)}function N(t,e,n){if(!1===n)return t[e];for(var r=e.split("."),i=t;r.length>0;)i=i[r.shift()];return i}function T(t,e,n){for(var r,i,o=0,s=t.length;o<s;){if(i=o+s>>1,0===(r=n.apply(null,[e,t[i]])))return{found:!0,index:i};r<0?s=i:o=i+1}return{found:!1,index:s}}function $(t){return function(e,n){return T(e,n,t)}}function q(){}function B(t){this.field=t,this.keyMap=Object.create(null),this.lokiMap=Object.create(null)}function F(t){this.index=Object.create(null),this.field=t}function R(t){this.field=t}return w.prototype.events={},w.prototype.asyncListeners=!1,w.prototype.on=function(t,e){var n,r=this;return Array.isArray(t)?(t.forEach((function(t){r.on(t,e)})),e):((n=this.events[t])||(n=this.events[t]=[]),n.push(e),e)},w.prototype.emit=function(t){var e,n=this;if(!t||!this.events[t])throw new Error("No event "+t+" defined");this.events[t].length&&(e=Array.prototype.slice.call(arguments,1),this.events[t].forEach((function(t){n.asyncListeners?setTimeout((function(){t.apply(n,e)}),1):t.apply(n,e)})))},w.prototype.addListener=w.prototype.on,w.prototype.removeListener=function(t,e){var n=this;if(Array.isArray(t))t.forEach((function(t){n.removeListener(t,e)}));else if(this.events[t]){var r=this.events[t];r.splice(r.indexOf(e),1)}},I.prototype=new w,I.prototype.constructor=I,I.prototype.getIndexedAdapter=function(){return n(7996)},I.prototype.configureOptions=function(t,e){var n={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"},r={fs:S,localStorage:O,memory:k};if(this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,void 0!==t){if(this.options=t,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof r[t.persistenceMethod]&&(this.persistenceMethod=t.persistenceMethod,this.persistenceAdapter=new r[t.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=t.adapter,this.options.adapter=null,this.isIncremental="incremental"===this.persistenceAdapter.mode),t.autoload&&e){var i=this;setTimeout((function(){i.loadDatabase(t,t.autoloadCallback)}),1)}this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(t,t.autosaveCallback):this.autosaveEnable()),this.options.hasOwnProperty("throttledSaves")&&(this.throttledSaves=this.options.throttledSaves)}this.options.hasOwnProperty("serializationMethod")||(this.options.serializationMethod="normal"),this.options.hasOwnProperty("destructureDelimiter")||(this.options.destructureDelimiter="$<\n"),null===this.persistenceAdapter&&(this.persistenceMethod=n[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new r[this.persistenceMethod]))},I.prototype.copy=function(t){var e,n,r=new I(this.filename,{env:"NA"});if(t=t||{},r.loadJSONObject(this,{retainDirtyFlags:!0}),t.hasOwnProperty("removeNonSerializable")&&!0===t.removeNonSerializable)for(r.autosaveHandle=null,r.persistenceAdapter=null,e=r.collections.length,n=0;n<e;n++)r.collections[n].constraints=null,r.collections[n].ttl=null;return r},I.prototype.addCollection=function(t,e){var n,r=this.collections.length;if(e&&!0===e.disableMeta){if(!1===e.disableChangesApi)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(!1===e.disableDeltaChangesApi)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if("number"==typeof e.ttl&&e.ttl>0)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(n=0;n<r;n+=1)if(this.collections[n].name===t)return this.collections[n];var i=new C(t,e);return i.isIncremental=this.isIncremental,this.collections.push(i),this.verbose&&(i.lokiConsoleWrapper=console),i},I.prototype.loadCollection=function(t){if(!t.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(t)},I.prototype.getCollection=function(t){var e,n=this.collections.length;for(e=0;e<n;e+=1)if(this.collections[e].name===t)return this.collections[e];return this.emit("warning","collection "+t+" not found"),null},I.prototype.renameCollection=function(t,e){var n=this.getCollection(t);return n&&(n.name=e),n},I.prototype.listCollections=function(){for(var t=this.collections.length,e=[];t--;)e.push({name:this.collections[t].name,type:this.collections[t].objType,count:this.collections[t].data.length});return e},I.prototype.removeCollection=function(t){var e,n=this.collections.length;for(e=0;e<n;e+=1)if(this.collections[e].name===t){var r=new C(t,{}),i=this.collections[e];for(var o in i)i.hasOwnProperty(o)&&r.hasOwnProperty(o)&&(i[o]=r[o]);return void this.collections.splice(e,1)}},I.prototype.getName=function(){return this.name},I.prototype.serializeReplacer=function(t,e){switch(t){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":case"lokiConsoleWrapper":return null;case"throttledSavePending":case"throttledCallbacks":return;default:return e}},I.prototype.serialize=function(t){switch((t=t||{}).hasOwnProperty("serializationMethod")||(t.serializationMethod=this.options.serializationMethod),t.serializationMethod){case"normal":default:return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured()}},I.prototype.toJson=I.prototype.serialize,I.prototype.serializeDestructured=function(t){var e,n,r,i,o,s=[];if((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),!0===t.partitioned&&t.hasOwnProperty("partition")&&t.partition>=0)return this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:t.partition});for((o=new I(this.filename)).loadJSONObject(this),e=0;e<o.collections.length;e++)o.collections[e].data=[];if(!0===t.partitioned&&-1===t.partition)return o.serialize({serializationMethod:"normal"});for(s.push(o.serialize({serializationMethod:"normal"})),o=null,e=0;e<this.collections.length;e++)if(r=this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:e}),!1===t.partitioned&&!1===t.delimited){if(!Array.isArray(r))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(i=r.length,n=0;n<i;n++)s.push(r[n]),r[n]=null;s.push("")}else s.push(r);return t.partitioned?(t.delimited,s):t.delimited?(s.push(""),s.join(t.delimiter)):(s.push(""),s)},I.prototype.serializeCollection=function(t){var e,n,r=[];if((t=t||{}).hasOwnProperty("delimited")||(t.delimited=!0),!t.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");for(e=this.collections[t.collectionIndex].data.length,r=[],n=0;n<e;n++)r.push(JSON.stringify(this.collections[t.collectionIndex].data[n]));return t.delimited?(r.push(""),r.join(t.delimiter)):r},I.prototype.deserializeDestructured=function(t,e){var n,r,i,o=[],s=0,a=1,u=!1;if((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.partitioned){if(e.hasOwnProperty("partition"))return-1===e.partition?n=JSON.parse(t[0]):this.deserializeCollection(t[e.partition+1],e);for(r=(n=JSON.parse(t[0])).collections.length,s=0;s<r;s++)n.collections[s].data=this.deserializeCollection(t[s+1],e);return n}if(e.delimited){if(o=t.split(e.delimiter),t=null,0===o.length)return null}else o=t;for(r=(n=JSON.parse(o[0])).collections.length,o[0]=null;!u;)o[a],""===o[a]?++s>r&&(u=!0):(i=JSON.parse(o[a]),n.collections[s].data.push(i)),o[a++]=null;return n},I.prototype.deserializeCollection=function(t,e){var n,r,i=[];for((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.delimited?(i=t.split(e.delimiter)).pop():i=t,r=i.length,n=0;n<r;n++)i[n]=JSON.parse(i[n]);return i},I.prototype.loadJSON=function(t,e){var n;if(0===t.length)n={};else switch(this.options.serializationMethod){case"normal":case"pretty":default:n=JSON.parse(t);break;case"destructured":n=this.deserializeDestructured(t)}this.loadJSONObject(n,e)},I.prototype.loadJSONObject=function(t,n){var r,i,s,a,u,c,l=0,h=t.collections?t.collections.length:0;function f(t){var e,r=n[t.name];return r.proto?(e=r.inflate||o.copyProperties,function(t){var n=new r.proto;return e(t,n),n}):r.inflate}for(this.name=t.name,t.hasOwnProperty("throttledSaves")&&n&&!n.hasOwnProperty("throttledSaves")&&(this.throttledSaves=t.throttledSaves),this.collections=[];l<h;l+=1){if(r=t.collections[l],(i=this.addCollection(r.name,{disableChangesApi:r.disableChangesApi,disableDeltaChangesApi:r.disableDeltaChangesApi,disableMeta:r.disableMeta,disableFreeze:!r.hasOwnProperty("disableFreeze")||r.disableFreeze})).adaptiveBinaryIndices=!!r.hasOwnProperty("adaptiveBinaryIndices")&&!0===r.adaptiveBinaryIndices,i.transactional=r.transactional,i.asyncListeners=r.asyncListeners,i.cloneObjects=r.cloneObjects,i.cloneMethod=r.cloneMethod||"parse-stringify",i.autoupdate=r.autoupdate,i.changes=r.changes,i.dirtyIds=r.dirtyIds||[],n&&!0===n.retainDirtyFlags?i.dirty=r.dirty:i.dirty=!1,s=r.data.length,a=0,n&&n.hasOwnProperty(r.name))for(u=f(r);a<s;a++)c=u(r.data[a]),i.data[a]=c,i.addAutoUpdateObserver(c),i.disableFreeze||e(i.data[a]);else for(;a<s;a++)i.data[a]=r.data[a],i.addAutoUpdateObserver(i.data[a]),i.disableFreeze||e(i.data[a]);if(i.maxId=void 0===r.maxId?0:r.maxId,void 0!==r.binaryIndices&&(i.binaryIndices=r.binaryIndices),void 0!==r.transforms&&(i.transforms=r.transforms),i.uniqueNames=[],r.hasOwnProperty("uniqueNames")&&(i.uniqueNames=r.uniqueNames),void 0!==r.DynamicViews){for(var d=0;d<r.DynamicViews.length;d++){var p=r.DynamicViews[d],y=i.addDynamicView(p.name,p.options);y.resultdata=p.resultdata,y.resultsdirty=p.resultsdirty,y.filterPipeline=p.filterPipeline,y.sortCriteriaSimple=p.sortCriteriaSimple,y.sortCriteria=p.sortCriteria,y.sortFunction=null,y.sortDirty=p.sortDirty,i.disableFreeze||(e(y.filterPipeline),y.sortCriteriaSimple?e(y.sortCriteriaSimple):y.sortCriteria&&e(y.sortCriteria)),y.resultset.filteredrows=p.resultset.filteredrows,y.resultset.filterInitialized=p.resultset.filterInitialized,y.rematerialize({removeWhereFilters:!0})}t.databaseVersion<1.5&&(i.ensureAllIndexes(!0),i.dirty=!0)}}},I.prototype.close=function(t){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&(this.saveDatabase(t),t=void 0)),t&&this.on("close",t),this.emit("close")},I.prototype.generateChangesNotification=function(t){function e(t){return t.name}var n=[],r=t||this.collections.map(e);return this.collections.forEach((function(t){-1!==r.indexOf(e(t))&&(n=n.concat(t.getChanges()))})),n},I.prototype.serializeChanges=function(t){return JSON.stringify(this.generateChangesNotification(t))},I.prototype.clearChanges=function(){this.collections.forEach((function(t){t.flushChanges&&t.flushChanges()}))},k.prototype.loadDatabase=function(t,e){var n=this;this.options.asyncResponses?setTimeout((function(){n.hashStore.hasOwnProperty(t)?e(n.hashStore[t].value):e(null)}),this.options.asyncTimeout):this.hashStore.hasOwnProperty(t)?e(this.hashStore[t].value):e(null)},k.prototype.saveDatabase=function(t,e,n){var r,i=this;this.options.asyncResponses?setTimeout((function(){r=i.hashStore.hasOwnProperty(t)?i.hashStore[t].savecount:0,i.hashStore[t]={savecount:r+1,lastsave:new Date,value:e},n()}),this.options.asyncTimeout):(r=this.hashStore.hasOwnProperty(t)?this.hashStore[t].savecount:0,this.hashStore[t]={savecount:r+1,lastsave:new Date,value:e},n())},k.prototype.deleteDatabase=function(t,e){this.hashStore.hasOwnProperty(t)&&delete this.hashStore[t],"function"==typeof e&&e()},x.prototype.loadDatabase=function(t,e){var n=this;this.dbname=t,this.dbref=new I(t),this.adapter.loadDatabase(t,(function(t){if(t){"string"!=typeof t&&e(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()"));var r=JSON.parse(t);n.dbref.loadJSONObject(r),r=null,n.dbref.collections.length,0!==n.dbref.collections.length?(n.pageIterator={collection:0,pageIndex:0},n.loadNextPartition(0,(function(){e(n.dbref)}))):e(n.dbref)}else e(t)}))},x.prototype.loadNextPartition=function(t,e){var n=this.dbname+"."+t,r=this;if(!0===this.options.paging)return this.pageIterator.pageIndex=0,void this.loadNextPage(e);this.adapter.loadDatabase(n,(function(n){var i=r.dbref.deserializeCollection(n,{delimited:!0,collectionIndex:t});r.dbref.collections[t].data=i,++t<r.dbref.collections.length?r.loadNextPartition(t,e):e()}))},x.prototype.loadNextPage=function(t){var e=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,n=this;this.adapter.loadDatabase(e,(function(e){var r=e.split(n.options.delimiter);e="";var i,o=r.length,s=""===r[o-1];for(s&&(r.pop(),""===r[(o=r.length)-1]&&1===o&&(r.pop(),o=r.length)),i=0;i<o;i++)n.dbref.collections[n.pageIterator.collection].data.push(JSON.parse(r[i])),r[i]=null;r=[],s?++n.pageIterator.collection<n.dbref.collections.length?n.loadNextPartition(n.pageIterator.collection,t):t():(n.pageIterator.pageIndex++,n.loadNextPage(t))}))},x.prototype.exportDatabase=function(t,e,n){var r,i=e.collections.length;for(this.dbref=e,this.dbname=t,this.dirtyPartitions=[-1],r=0;r<i;r++)e.collections[r].dirty&&this.dirtyPartitions.push(r);this.saveNextPartition((function(t){n(t)}))},x.prototype.saveNextPartition=function(t){var e=this,n=this.dirtyPartitions.shift(),r=this.dbname+(-1===n?"":"."+n);if(this.options.paging&&-1!==n)return this.pageIterator={collection:n,docIndex:0,pageIndex:0},void this.saveNextPage((function(n){0===e.dirtyPartitions.length?t(n):e.saveNextPartition(t)}));var i=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:n});this.adapter.saveDatabase(r,i,(function(n){n?t(n):0===e.dirtyPartitions.length?t(null):e.saveNextPartition(t)}))},x.prototype.saveNextPage=function(t){var e=this,n=this.dbref.collections[this.pageIterator.collection],r=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,i=0,o=n.data.length,s=this.options.delimiter.length,a="",u="",c=!1,l=!1,h=function(n){u="",n&&t(n),c?t(null):(e.pageIterator.pageIndex++,e.saveNextPage(t))};for(0===n.data.length&&(c=!0);;)if(c||(a=JSON.stringify(n.data[this.pageIterator.docIndex]),u+=a,i+=a.length,++this.pageIterator.docIndex>=o&&(c=!0)),i>=this.options.pageSize&&(l=!0),l&&!c||(u+=this.options.delimiter,i+=s),c||l)return void this.adapter.saveDatabase(r,u,h)},S.prototype.loadDatabase=function(t,e){var n=this;this.fs.stat(t,(function(r,i){!r&&i.isFile()?n.fs.readFile(t,{encoding:"utf8"},(function(t,n){e(t?new Error(t):n)})):e(null)}))},S.prototype.saveDatabase=function(t,e,n){var r=this,i=t+"~";this.fs.writeFile(i,e,(function(e){e?n(new Error(e)):r.fs.rename(i,t,n)}))},S.prototype.deleteDatabase=function(t,e){this.fs.unlink(t,(function(t){t?e(new Error(t)):e()}))},O.prototype.loadDatabase=function(t,e){g()?e(localStorage.getItem(t)):e(new Error("localStorage is not available"))},O.prototype.saveDatabase=function(t,e,n){g()?(localStorage.setItem(t,e),n(null)):n(new Error("localStorage is not available"))},O.prototype.deleteDatabase=function(t,e){g()?(localStorage.removeItem(t),e(null)):e(new Error("localStorage is not available"))},I.prototype.throttledSaveDrain=function(t,e){var n=this,r=(new Date).getTime();if(this.throttledSaves||t(!0),(e=e||{}).hasOwnProperty("recursiveWait")||(e.recursiveWait=!0),e.hasOwnProperty("recursiveWaitLimit")||(e.recursiveWaitLimit=!1),e.hasOwnProperty("recursiveWaitLimitDuration")||(e.recursiveWaitLimitDuration=2e3),e.hasOwnProperty("started")||(e.started=(new Date).getTime()),this.throttledSaves&&this.throttledSavePending){if(!e.recursiveWait)return void this.throttledCallbacks.push(t);this.throttledCallbacks.push((function(){return n.throttledSavePending?e.recursiveWaitLimit&&r-e.started>e.recursiveWaitLimitDuration?void t(!1):void n.throttledSaveDrain(t,e):void t(!0)}))}else t(!0)},I.prototype.loadDatabaseInternal=function(t,e){var n=e||function(t,e){if(t)throw t},r=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,(function(e){if("string"==typeof e){var i=!1;try{r.loadJSON(e,t||{}),i=!0}catch(t){n(t)}i&&(n(null),r.emit("loaded","database "+r.filename+" loaded"))}else{if(!e)return n(null),void r.emit("loaded","empty database "+r.filename+" loaded");if(e instanceof Error)return void n(e);if("object"==typeof e)return r.loadJSONObject(e,t||{}),n(null),void r.emit("loaded","database "+r.filename+" loaded");n("unexpected adapter response : "+e)}})):n(new Error("persistenceAdapter not configured"))},I.prototype.loadDatabase=function(t,e){var n=this;this.throttledSaves?this.throttledSaveDrain((function(r){if(r)return n.throttledSavePending=!0,void n.loadDatabaseInternal(t,(function(t){0===n.throttledCallbacks.length?n.throttledSavePending=!1:n.saveDatabase(),"function"==typeof e&&e(t)}));"function"==typeof e&&e(new Error("Unable to pause save throttling long enough to read database"))}),t):this.loadDatabaseInternal(t,e)},I.prototype.saveDatabaseInternal=function(t){var e,n=t||function(t){if(t)throw t},r=this;this.persistenceAdapter?"incremental"===this.persistenceAdapter.mode?(this.ignoreAutosave=!0,this.persistenceAdapter.saveDatabase(this.filename,(function(){if(r.ignoreAutosave=!1,!e){var t=r.copy({removeNonSerializable:!0});return e=r.collections.map((function(t){return[t.dirty,t.dirtyIds]})),r.collections.forEach((function(t){t.dirty=!1,t.dirtyIds=[]})),t}n(new Error("adapter error - getLokiCopy called more than once"))}),(function(t){r.ignoreAutosave=!1,t&&e&&r.collections.forEach((function(t,n){var r=e[n];t.dirty=t.dirty||r[0],t.dirtyIds=t.dirtyIds.concat(r[1])})),n(t)}))):"reference"===this.persistenceAdapter.mode&&"function"==typeof this.persistenceAdapter.exportDatabase?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),(function(t){r.autosaveClearFlags(),n(t)})):(this.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,this.serialize(),(function(t){n(t)}))):n(new Error("persistenceAdapter not configured"))},I.prototype.saveDatabase=function(t){if(this.throttledSaves)if(this.throttledSavePending)this.throttledCallbacks.push(t);else{var e=this.throttledCallbacks;this.throttledCallbacks=[],e.unshift(t),this.throttledSavePending=!0;var n=this;this.saveDatabaseInternal((function(t){n.throttledSavePending=!1,e.forEach((function(e){"function"==typeof e&&setTimeout((function(){e(t)}),1)})),n.throttledCallbacks.length>0&&n.saveDatabase()}))}else this.saveDatabaseInternal(t)},I.prototype.save=I.prototype.saveDatabase,I.prototype.deleteDatabase=function(t,e){var n=e||function(t,e){if(t)throw t};"function"!=typeof t||e||(n=t),null!==this.persistenceAdapter?this.persistenceAdapter.deleteDatabase(this.filename,(function(t){n(t)})):n(new Error("persistenceAdapter not configured"))},I.prototype.autosaveDirty=function(){for(var t=0;t<this.collections.length;t++)if(this.collections[t].dirty)return!0;return!1},I.prototype.autosaveClearFlags=function(){for(var t=0;t<this.collections.length;t++)this.collections[t].dirty=!1},I.prototype.autosaveEnable=function(t,e){this.autosave=!0;var n=5e3,r=this;void 0!==this.autosaveInterval&&null!==this.autosaveInterval&&(n=this.autosaveInterval),this.autosaveHandle=setInterval((function(){r.autosaveDirty()&&!r.ignoreAutosave&&r.saveDatabase(e)}),n)},I.prototype.autosaveDisable=function(){void 0!==this.autosaveHandle&&null!==this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},P.prototype.reset=function(){return this.filteredrows.length>0&&(this.filteredrows=[]),this.filterInitialized=!1,this},P.prototype.toJSON=function(){var t=this.copy();return t.collection=null,t},P.prototype.limit=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new P(this.collection);return e.filteredrows=this.filteredrows.slice(0,t),e.filterInitialized=!0,e},P.prototype.offset=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new P(this.collection);return e.filteredrows=this.filteredrows.slice(t),e.filterInitialized=!0,e},P.prototype.copy=function(){var t=new P(this.collection);return this.filteredrows.length>0&&(t.filteredrows=this.filteredrows.slice()),t.filterInitialized=this.filterInitialized,t},P.prototype.branch=P.prototype.copy,P.prototype.transform=function(t,e){var n,r,i=this;if("string"==typeof t&&this.collection.transforms.hasOwnProperty(t)&&(t=this.collection.transforms[t]),"object"!=typeof t||!Array.isArray(t))throw new Error("Invalid transform");for(void 0!==e&&(t=o.resolveTransformParams(t,e)),n=0;n<t.length;n++)switch((r=t[n]).type){case"find":i.find(r.value);break;case"where":i.where(r.value);break;case"simplesort":i.simplesort(r.property,r.desc||r.options);break;case"compoundsort":i.compoundsort(r.value);break;case"sort":i.sort(r.value);break;case"limit":i=i.limit(r.value);break;case"offset":i=i.offset(r.value);break;case"map":i=i.map(r.value,r.dataOptions);break;case"eqJoin":i=i.eqJoin(r.joinData,r.leftJoinKey,r.rightJoinKey,r.mapFun,r.dataOptions);break;case"mapReduce":i=i.mapReduce(r.mapFunction,r.reduceFunction);break;case"update":i.update(r.value);break;case"remove":i.remove()}return i},P.prototype.sort=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e,n,r=(e=t,n=this.collection.data,function(t,r){return e(n[t],n[r])});return this.filteredrows.sort(r),this},P.prototype.simplesort=function(t,e){var n,r=10,i=this.collection.data.length,s=this.filteredrows.length,a=this.collection.binaryIndices.hasOwnProperty(t);if(void 0!==e&&!1!==e||(e={desc:!1}),!0===e&&(e={desc:!0}),0===s){if(this.filterInitialized)return this;if(this.collection.binaryIndices.hasOwnProperty(t))return this.collection.ensureIndex(t),this.filteredrows=this.collection.binaryIndices[t].values.slice(0),e.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!e.disableIndexIntersect&&a&&(n=i/s,e.useJavascriptSorting&&(r=6),n<=r||e.forceIndexIntersect)){var u,c=this.filteredrows,h={};for(u=0;u<s;u++)h[c[u]]=!0;var f=this.collection.binaryIndices[t].values;return this.filteredrows=f.filter((function(t){return h[t]})),e.desc&&this.filteredrows.reverse(),this}if(e.useJavascriptSorting)return this.sort((function(e,n){return e[t]===n[t]?0:e[t]>n[t]?1:e[t]<n[t]?-1:void 0}));var d,p,y,v,m,b,g=(d=t,p=e.desc,y=this.collection.data,function(t,e){return~d.indexOf(".")?(b=d.split("."),v=o.getIn(y[t],b,!0),m=o.getIn(y[e],b,!0)):(v=y[t][d],m=y[e][d]),l(v,m,p)});return this.filteredrows.sort(g),this},P.prototype.compoundsort=function(t){if(0===t.length)throw new Error("Invalid call to compoundsort, need at least one property");var e;if(1===t.length)return e=t[0],Array.isArray(e)?this.simplesort(e[0],e[1]):this.simplesort(e,!1);for(var n=0,r=t.length;n<r;n+=1)e=t[n],Array.isArray(e)||(t[n]=[e,!1]);this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var i,o,s=(i=t,o=this.collection.data,function(t,e){return h(i,o[t],o[e])});return this.filteredrows.sort(s),this},P.prototype.findOr=function(t){for(var e=null,n=0,r=0,i=[],o=[],s=0,a=(this.count(),0),u=t.length;a<u;a++)for(r=(e=this.branch().find(t[a]).filteredrows).length,n=0;n<r;n++)void 0===o[s=e[n]]&&(o[s]=!0,i.push(s));return this.filteredrows=i,this.filterInitialized=!0,this},P.prototype.$or=P.prototype.findOr,P.prototype.findAnd=function(t){for(var e=0,n=t.length;e<n;e++){if(0===this.count())return this;this.find(t[e])}return this},P.prototype.$and=P.prototype.findAnd,P.prototype.find=function(e,n){if(0===this.collection.data.length)return this.filteredrows=[],this.filterInitialized=!0,this;var r,i,s,a,u,c,l,h=e||"getAll",d=!1,p=[],m=[],b=null;if(n=n||!1,"object"==typeof h){for(r in h)(a={})[r]=h[r],m.push(a),t.call(h,r)&&(i=r,s=h[r]);if(m.length>1)return this.find({$and:m},n)}if(!i||"getAll"===h)return n&&(this.filterInitialized?this.filteredrows=this.filteredrows.slice(0,1):(this.filteredrows=this.collection.data.length>0?[0]:[],this.filterInitialized=!0)),this;if("$and"===i||"$or"===i)return this[i](s),n&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this;if(null===s||"object"!=typeof s||s instanceof Date)u="$eq",c=s;else{if("object"!=typeof s)throw new Error("Do not know what you want to do.");for(l in s)if(t.call(s,l)){u=l,c=s[l];break}}"$regex"!==u&&"object"!=typeof c||(c=D(u,c));var g=-1!==i.indexOf(".");!this.filterInitialized&&this.collection.binaryIndices[i]&&v[u]&&(!0!==this.collection.adaptiveBinaryIndices&&this.collection.ensureIndex(i),d=!0,b=this.collection.binaryIndices[i]),!d&&"$in"===u&&Array.isArray(c)&&"undefined"!=typeof Set&&(c=new Set(c),u="$inSet");var w,I,k=y[u],x=this.collection.data,S=0,O=0,P=0;if(this.filterInitialized){if(O=(w=this.filteredrows).length,g){for(i=i.split("."),S=0;S<O;S++)if(f(I=x[P=w[S]],i,k,c,I)&&(p.push(P),n))return this.filteredrows=p,this}else for(S=0;S<O;S++)if(k((I=x[P=w[S]])[i],c,I)&&(p.push(P),n))return this.filteredrows=p,this}else if(d){var E=this.collection.calculateRange(u,i,c);if("$in"!==u){for(S=E[0];S<=E[1];S++)if(!0!==v[u]){if(v[u](o.getIn(x[b.values[S]],i,g),c)&&(p.push(b.values[S]),n))return this.filteredrows=p,this.filterInitialized=!0,this}else if(p.push(b.values[S]),n)return this.filteredrows=p,this.filterInitialized=!0,this}else for(S=0,O=E.length;S<O;S++)if(p.push(b.values[E[S]]),n)return this.filteredrows=p,this.filterInitialized=!0,this}else if(O=x.length,g){for(i=i.split("."),S=0;S<O;S++)if(f(I=x[S],i,k,c,I)&&(p.push(S),n))return this.filteredrows=p,this.filterInitialized=!0,this}else for(S=0;S<O;S++)if(k((I=x[S])[i],c,I)&&(p.push(S),n))return this.filteredrows=p,this.filterInitialized=!0,this;return this.filteredrows=p,this.filterInitialized=!0,this},P.prototype.where=function(t){var e,n=[];if("function"!=typeof t)throw new TypeError("Argument is not a stored view or a function");e=t;try{if(this.filterInitialized){for(var r=this.filteredrows.length;r--;)!0===e(this.collection.data[this.filteredrows[r]])&&n.push(this.filteredrows[r]);return this.filteredrows=n,this}for(var i=this.collection.data.length;i--;)!0===e(this.collection.data[i])&&n.push(i);return this.filteredrows=n,this.filterInitialized=!0,this}catch(t){throw t}},P.prototype.count=function(){return this.filterInitialized?this.filteredrows.length:this.collection.count()},P.prototype.data=function(t){var e,n,r,i,o=[],s=this.collection.data;if((t=t||{}).removeMeta&&!t.forceClones&&(t.forceClones=!0,t.forceCloneMethod=t.forceCloneMethod||"shallow"),!this.collection.disableDeltaChangesApi&&this.collection.disableFreeze&&(t.forceClones=!0,t.forceCloneMethod="parse-stringify"),!this.filterInitialized){if(0===this.filteredrows.length){if(this.collection.cloneObjects||t.forceClones){for(n=s.length,i=t.forceCloneMethod||this.collection.cloneMethod,r=0;r<n;r++)e=m(s[r],i),t.removeMeta&&(delete e.$loki,delete e.meta),o.push(e);return o}return s.slice()}this.filterInitialized=!0}var a=this.filteredrows;if(n=a.length,this.collection.cloneObjects||t.forceClones)for(i=t.forceCloneMethod||this.collection.cloneMethod,r=0;r<n;r++)e=m(s[a[r]],i),t.removeMeta&&(delete e.$loki,delete e.meta),o.push(e);else for(r=0;r<n;r++)o.push(s[a[r]]);return o},P.prototype.update=function(t){if("function"!=typeof t)throw new TypeError("Argument is not a function");this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());for(var e,n=this.filteredrows.length,r=this.collection.data,i=0;i<n;i++)this.disableFreeze&&!this.collection.cloneObjects&&this.collection.disableDeltaChangesApi?(t(r[this.filteredrows[i]]),this.collection.update(r[this.filteredrows[i]])):(t(e=m(r[this.filteredrows[i]],this.collection.cloneMethod)),this.collection.update(e));return this},P.prototype.remove=function(){return this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this},P.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},P.prototype.eqJoin=function(t,e,n,r,i){var o,s,a,u=[],c=[],l=[],h="function"==typeof e,f="function"==typeof n,d={};if(o=(u=this.data(i)).length,t instanceof C)c=t.chain().data(i);else if(t instanceof P)c=t.data(i);else{if(!Array.isArray(t))throw new TypeError("joinData needs to be an array or result set");c=t}s=c.length;for(var p=0;p<s;p++)d[a=f?n(c[p]):c[p][n]]=c[p];r||(r=function(t,e){return{left:t,right:e}});for(var y=0;y<o;y++)a=h?e(u[y]):u[y][e],l.push(r(u[y],d[a]||{}));return this.collection=new C("joinData"),this.collection.insert(l),this.filteredrows=[],this.filterInitialized=!1,this},P.prototype.map=function(t,e){var n=this.data(e).map(t);return this.collection=new C("mappedData"),this.collection.insert(n),this.filteredrows=[],this.filterInitialized=!1,this},E.prototype=new w,E.prototype.constructor=E,E.prototype.getSort=function(){return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple},E.prototype.rematerialize=function(t){var e,n,r;t=t||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new P(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0);var i=Object.isFrozen(this.filterPipeline);if(t.hasOwnProperty("removeWhereFilters"))for(i&&(this.filterPipeline=this.filterPipeline.slice()),n=e=this.filterPipeline.length;n--;)"where"===this.filterPipeline[n].type&&(n!==this.filterPipeline.length-1&&(this.filterPipeline[n]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var o=this.filterPipeline;for(this.filterPipeline=[],e=o.length,r=0;r<e;r++)this.applyFind(o[r].val,o[r].uid);return i&&Object.freeze(this.filterPipeline),this.data(),this.emit("rebuild",this),this},E.prototype.branchResultset=function(t,e){var n=this.resultset.branch();return void 0===t?n:n.transform(t,e)},E.prototype.toJSON=function(){var t=new E(this.collection,this.name,this.options);return t.resultset=this.resultset,t.resultdata=[],t.resultsdirty=!0,t.filterPipeline=this.filterPipeline,t.sortFunction=this.sortFunction,t.sortCriteria=this.sortCriteria,t.sortCriteriaSimple=this.sortCriteriaSimple||null,t.sortDirty=this.sortDirty,t.collection=null,t},E.prototype.removeFilters=function(t){t=t||{},this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null;var e=Object.isFrozen(this.filterPipeline),n=this.filterPipeline.length>0;this.filterPipeline=[],e&&Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,!0===t.queueSortPhase&&this.queueSortPhase(),n&&this.emit("filter")},E.prototype.applySort=function(t){return this.sortFunction=t,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this.emit("sort"),this},E.prototype.applySimpleSort=function(t,n){return this.sortCriteriaSimple={propname:t,options:n||!1},this.collection.disableFreeze||e(this.sortCriteriaSimple),this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},E.prototype.applySortCriteria=function(t){return this.sortCriteria=t,this.collection.disableFreeze||e(this.sortCriteria),this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},E.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},E.prototype.commit=function(){return this.cachedresultset=null,this},E.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},E.prototype._indexOfFilterWithId=function(t){if("string"==typeof t||"number"==typeof t)for(var e=0,n=this.filterPipeline.length;e<n;e+=1)if(t===this.filterPipeline[e].uid)return e;return-1},E.prototype._addFilter=function(t){var n=Object.isFrozen(this.filterPipeline);n&&(this.filterPipeline=this.filterPipeline.slice()),this.collection.disableFreeze||e(t),this.filterPipeline.push(t),n&&Object.freeze(this.filterPipeline),this.resultset[t.type](t.val)},E.prototype.reapplyFilters=function(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);var t=this.filterPipeline,e=Object.isFrozen(t);this.filterPipeline=[];for(var n=0,r=t.length;n<r;n+=1)this._addFilter(t[n]);return e&&Object.freeze(this.filterPipeline),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},E.prototype.applyFilter=function(t){var e=this._indexOfFilterWithId(t.uid);if(e>=0){var n=Object.isFrozen(this.filterPipeline);return n&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline[e]=t,n&&(r(t),Object.freeze(this.filterPipeline)),this.reapplyFilters()}return this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(t),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},E.prototype.applyFind=function(t,e){return this.applyFilter({type:"find",val:t,uid:e}),this},E.prototype.applyWhere=function(t,e){return this.applyFilter({type:"where",val:t,uid:e}),this},E.prototype.removeFilter=function(t){var e=this._indexOfFilterWithId(t);if(e<0)throw new Error("Dynamic view does not contain a filter with ID: "+t);var n=Object.isFrozen(this.filterPipeline);return n&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline.splice(e,1),n&&Object.freeze(this.filterPipeline),this.reapplyFilters(),this},E.prototype.count=function(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()},E.prototype.data=function(t){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(t)},E.prototype.queueRebuildEvent=function(){if(!this.rebuildPending){this.rebuildPending=!0;var t=this;setTimeout((function(){t.rebuildPending&&(t.rebuildPending=!1,t.emit("rebuild",t))}),this.options.minRebuildInterval)}},E.prototype.queueSortPhase=function(){if(!this.sortDirty){this.sortDirty=!0;var t=this;"active"===this.options.sortPriority?setTimeout((function(){t.performSortPhase()}),this.options.minRebuildInterval):this.queueRebuildEvent()}},E.prototype.performSortPhase=function(t){(this.sortDirty||this.resultsdirty)&&(t=t||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),t.suppressRebuildEvent||this.emit("rebuild",this))},E.prototype.evaluateDocument=function(t,e){if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var n,r=this.resultset.filteredrows,i=e?-1:r.indexOf(+t),o=r.length,s=new P(this.collection);s.filteredrows=[t],s.filterInitialized=!0;for(var a=0,u=this.filterPipeline.length;a<u;a++)s[(n=this.filterPipeline[a]).type](n.val);var c=0===s.filteredrows.length?-1:0;return-1!==i||-1!==c?-1===i&&-1!==c?(r.push(t),this.options.persistent&&this.resultdata.push(this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==i&&-1===c?(i<o-1?(r.splice(i,1),this.options.persistent&&this.resultdata.splice(i,1)):(r.length=o-1,this.options.persistent&&(this.resultdata.length=o-1)),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==i&&-1!==c?(this.options.persistent&&(this.resultdata[i]=this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):void 0:void 0},E.prototype.removeDocument=function(t){var e,n,r,i={},o={},s=[],a=this.resultset,u=this.resultset.filteredrows,c=u.length;if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(Array.isArray(t)||(t=[t]),r=t.length,n=0;n<r;n++)i[t[n]]=!0;for(e=0;e<c;e++)i[u[e]]&&(o[e]=!0);Object.keys(o).length>0&&(this.resultset.filteredrows=this.resultset.filteredrows.filter((function(t,e){return!o[e]})),this.options.persistent&&(this.resultdata=this.resultdata.filter((function(t,e){return!o[e]}))),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var l=function(t){return function(e){return e<a.filteredrows[t]}};for(c=a.filteredrows.length,e=0;e<c;e++)s=t.filter(l(e)),a.filteredrows[e]-=s.length},E.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},C.prototype=new w,C.prototype.contructor=C,C.prototype.createChange=function(t,e,n,r){this.changes.push({name:t,operation:e,obj:"U"!=e||this.disableDeltaChangesApi?JSON.parse(JSON.stringify(n)):this.getChangeDelta(n,r)})},C.prototype.insertMeta=function(t){var e,n;if(!this.disableMeta&&t)if(Array.isArray(t))for(e=t.length,n=0;n<e;n++)t[n].hasOwnProperty("meta")||(t[n].meta={}),t[n].meta.created=(new Date).getTime(),t[n].meta.revision=0;else t.meta||(t.meta={}),t.meta.created=(new Date).getTime(),t.meta.revision=0},C.prototype.updateMeta=function(t){return this.disableMeta||!t||(this.disableFreeze||((t=i(t)).meta=i(t.meta)),t.meta.updated=(new Date).getTime(),t.meta.revision+=1),t},C.prototype.createInsertChange=function(t){this.createChange(this.name,"I",t)},C.prototype.createUpdateChange=function(t,e){this.createChange(this.name,"U",t,e)},C.prototype.insertMetaWithChange=function(t){this.insertMeta(t),this.createInsertChange(t)},C.prototype.updateMetaWithChange=function(t,e,n){return t=this.updateMeta(t,n),this.createUpdateChange(t,e),t},C.prototype.lokiConsoleWrapper={log:function(){},warn:function(){},error:function(){}},C.prototype.addAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.observe(t,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])},C.prototype.removeAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.unobserve(t,this.observerCallback)},C.prototype.addTransform=function(t,e){if(this.transforms.hasOwnProperty(t))throw new Error("a transform by that name already exists");this.transforms[t]=e},C.prototype.getTransform=function(t){return this.transforms[t]},C.prototype.setTransform=function(t,e){this.transforms[t]=e},C.prototype.removeTransform=function(t){delete this.transforms[t]},C.prototype.byExample=function(t){var e,n,r;for(e in r=[],t)t.hasOwnProperty(e)&&r.push(((n={})[e]=t[e],n));return{$and:r}},C.prototype.findObject=function(t){return this.findOne(this.byExample(t))},C.prototype.findObjects=function(t){return this.find(this.byExample(t))},C.prototype.ttlDaemonFuncGen=function(){var t=this,e=this.ttl.age;return function(){var n=Date.now();t.chain().where((function(t){var r=t.meta.updated||t.meta.created;return e<n-r})).remove()}},C.prototype.setTTL=function(t,e){t<0?clearInterval(this.ttl.daemon):(this.ttl.age=t,this.ttl.ttlInterval=e,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),e))},C.prototype.prepareFullDocIndex=function(){for(var t=this.data.length,e=new Array(t),n=0;n<t;n+=1)e[n]=n;return e},C.prototype.configureOptions=function(t){(t=t||{}).hasOwnProperty("adaptiveBinaryIndices")&&(this.adaptiveBinaryIndices=t.adaptiveBinaryIndices,this.adaptiveBinaryIndices&&this.ensureAllIndexes())},C.prototype.ensureIndex=function(t,e){if(void 0===e&&(e=!1),null==t)throw new Error("Attempting to set index without an associated property");if((!this.binaryIndices[t]||e||this.binaryIndices[t].dirty)&&(!0!==this.adaptiveBinaryIndices||!this.binaryIndices.hasOwnProperty(t)||e)){var n={name:t,dirty:!0,values:this.prepareFullDocIndex()};this.binaryIndices[t]=n;var r,i,a,u,c,l=(r=t,i=this.data,c=!!~r.indexOf(".")&&r.split("."),function(t,e){if(c?(a=o.getIn(i[t],c,!0),u=o.getIn(i[e],c,!0)):(a=i[t][r],u=i[e][r]),a!==u){if(s.lt(a,u,!1))return-1;if(s.gt(a,u,!1))return 1}return 0});n.values.sort(l),n.dirty=!1,this.dirty=!0}},C.prototype.checkAllIndexes=function(e){var n,r=this.binaryIndices,i=[];for(n in r)t.call(r,n)&&(this.checkIndex(n,e)||i.push(n));return i},C.prototype.checkIndex=function(t,e){(e=e||{}).randomSamplingFactor&&!1!==e.randomSampling&&(e.randomSampling=!0),e.randomSamplingFactor=e.randomSamplingFactor||.1,(e.randomSamplingFactor<0||e.randomSamplingFactor>1)&&(e.randomSamplingFactor=.1);var n,r,i,s,a,u=!0;if(!this.binaryIndices.hasOwnProperty(t))throw new Error("called checkIndex on property without an index: "+t);if(this.adaptiveBinaryIndices||this.ensureIndex(t),(s=(a=this.binaryIndices[t].values).length)!==this.data.length)return e.repair&&this.ensureIndex(t,!0),!1;if(0===s)return!0;var c=-1!==t.indexOf(".");if(1===s)u=0===a[0];else if(e.randomSampling){if(y.$lte(o.getIn(this.data[a[0]],t,c),o.getIn(this.data[a[1]],t,c))||(u=!1),y.$lte(o.getIn(this.data[a[s-2]],t,c),o.getIn(this.data[a[s-1]],t,c))||(u=!1),u)for(r=Math.floor((s-1)*e.randomSamplingFactor),n=0;n<r-1;n++)if(i=Math.floor(Math.random()*(s-1)),!y.$lte(o.getIn(this.data[a[i]],t,c),o.getIn(this.data[a[i+1]],t,c))){u=!1;break}}else for(n=0;n<s-1;n++)if(!y.$lte(o.getIn(this.data[a[n]],t,c),o.getIn(this.data[a[n+1]],t,c))){u=!1;break}return!u&&e.repair&&this.ensureIndex(t,!0),u},C.prototype.getBinaryIndexValues=function(t){var e,n=this.binaryIndices[t].values,r=[];for(e=0;e<n.length;e++)r.push(o.getIn(this.data[n[e]],t,!0));return r},C.prototype.getUniqueIndex=function(t,e){var n=this.constraints.unique[t];return!n&&e?this.ensureUniqueIndex(t):n},C.prototype.ensureUniqueIndex=function(t){var e=this.constraints.unique[t];return e||-1==this.uniqueNames.indexOf(t)&&this.uniqueNames.push(t),this.constraints.unique[t]=e=new B(t),this.data.forEach((function(t){e.set(t)})),e},C.prototype.ensureAllIndexes=function(e){var n,r=this.binaryIndices;for(n in r)t.call(r,n)&&this.ensureIndex(n,e)},C.prototype.flagBinaryIndexesDirty=function(){var e,n=this.binaryIndices;for(e in n)t.call(n,e)&&(n[e].dirty=!0)},C.prototype.flagBinaryIndexDirty=function(t){this.binaryIndices[t]&&(this.binaryIndices[t].dirty=!0)},C.prototype.count=function(t){return t?this.chain().find(t).filteredrows.length:this.data.length},C.prototype.ensureId=function(){if(!this.idIndex){for(var t=this.data,e=0,n=t.length,r=new Array(n);e<n;e++)r[e]=t[e].$loki;this.idIndex=r}},C.prototype.ensureIdAsync=function(t){this.async((function(){this.ensureId()}),t)},C.prototype.addDynamicView=function(t,e){var n=new E(this,t,e);return this.DynamicViews.push(n),n},C.prototype.removeDynamicView=function(t){this.DynamicViews=this.DynamicViews.filter((function(e){return e.name!==t}))},C.prototype.getDynamicView=function(t){for(var e=0;e<this.DynamicViews.length;e++)if(this.DynamicViews[e].name===t)return this.DynamicViews[e];return null},C.prototype.findAndUpdate=function(t,e){"function"==typeof t?this.updateWhere(t,e):this.chain().find(t).update(e)},C.prototype.findAndRemove=function(t){this.chain().find(t).remove()},C.prototype.insert=function(t,e){if(!Array.isArray(t))return this.insertOne(t);var n,r=[],i=e&&!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0;i&&(this.adaptiveBinaryIndices=!1);try{this.emit("pre-insert",t);for(var o=0,s=t.length;o<s;o++){if(!(n=this.insertOne(t[o],!0)))return;r.push(n)}}finally{i&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}return this.emit("insert",r),1===(r=this.cloneObjects?m(r,this.cloneMethod):r).length?r[0]:r},C.prototype.insertOne=function(t,n){var r,o=null;if("object"!=typeof t?o=new TypeError("Document needs to be an object"):null===t&&(o=new TypeError("Object cannot be null")),null!==o)throw this.emit("error",o),o;var s=this.cloneObjects?m(t,this.cloneMethod):t;if(this.disableFreeze||(s=i(s)),this.disableMeta||(void 0===s.meta?s.meta={revision:0,created:0}:this.disableFreeze||(s.meta=i(s.meta))),n||this.emit("pre-insert",s),this.add(s))return this.disableChangesApi?this.insertMeta(s):this.insertMetaWithChange(s),this.disableFreeze||e(s),r=this.cloneObjects?m(s,this.cloneMethod):s,n||this.emit("insert",r),this.addAutoUpdateObserver(r),r},C.prototype.clear=function(t){var e=this;t=t||{},this.data=[],this.idIndex=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,this.constraints={unique:{},exact:{}},!0===t.removeIndices?(this.binaryIndices={},this.uniqueNames=[]):Object.keys(this.binaryIndices).forEach((function(t){e.binaryIndices[t].dirty=!1,e.binaryIndices[t].values=[]}))},C.prototype.update=function(n){var r,i,o;if(Array.isArray(n)){o=n.length,(r=!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0)&&(this.adaptiveBinaryIndices=!1);try{for(i=0;i<o;i+=1)this.update(n[i])}finally{r&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}}else{if(!t.call(n,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();var s,a,u,c,l,h=this.get(n.$loki,!0),f=this;if(!h)throw new Error("Trying to update a document not in collection.");s=h[0],u=h[1],a=this.cloneObjects||!this.disableDeltaChangesApi&&this.disableFreeze?m(n,this.cloneMethod):n,this.emit("pre-update",n),this.uniqueNames.forEach((function(t){f.getUniqueIndex(t,!0).update(s,a)})),this.data[u]=a,a!==n&&this.addAutoUpdateObserver(n);for(var d=0;d<this.DynamicViews.length;d++)this.DynamicViews[d].evaluateDocument(u,!1);if(this.adaptiveBinaryIndices){var p=this.binaryIndices;for(c in p)this.adaptiveBinaryIndexUpdate(u,c)}else this.flagBinaryIndexesDirty();return this.idIndex[u]=a.$loki,this.isIncremental&&this.dirtyIds.push(a.$loki),this.commit(),this.dirty=!0,a=this.disableChangesApi?this.updateMeta(a):this.updateMetaWithChange(a,s),this.disableFreeze||e(a),l=this.cloneObjects?m(a,this.cloneMethod):a,this.emit("update",l,s),l}catch(t){throw this.rollback(),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),t}}},C.prototype.add=function(t){if("object"!=typeof t)throw new TypeError("Object being added needs to be an object");if(void 0!==t.$loki)throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1);var e=this.maxId;t.$loki=e,this.disableMeta||(t.meta.version=0);for(var n=0,r=this.uniqueNames.length;n<r;n++)this.getUniqueIndex(this.uniqueNames[n],!0).set(t);this.idIndex&&this.idIndex.push(e),this.isIncremental&&this.dirtyIds.push(e),this.data.push(t);var i=this.data.length-1,o=this.DynamicViews.length;for(n=0;n<o;n++)this.DynamicViews[n].evaluateDocument(i,!0);if(this.adaptiveBinaryIndices){var s=this.binaryIndices;for(var a in s)this.adaptiveBinaryIndexInsert(i,a)}else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?m(t,this.cloneMethod):t}catch(t){throw this.rollback(),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),t}},C.prototype.updateWhere=function(t,e){var n,r=this.where(t),i=0;try{for(;i<r.length;i++)n=e(r[i]),this.update(n)}catch(t){this.rollback(),this.lokiConsoleWrapper.error(t.message)}},C.prototype.removeWhere=function(t){var e;"function"==typeof t?(e=this.data.filter(t),this.remove(e)):this.chain().find(t).remove()},C.prototype.removeDataOnly=function(){this.remove(this.data.slice())},C.prototype.removeBatchByPositions=function(t){var e,n,r,i,o=t.length,s={},a=Object.keys(this.binaryIndices).length,u=Object.keys(this.constraints.unique).length,c=this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0,l=this;try{for(this.startTransaction(),this.ensureId(),r=0;r<o;r++)s[this.idIndex[t[r]]]=!0;if((e=this.DynamicViews.length)>0||a>0||u>0){if(e>0)for(n=0;n<e;n++)this.DynamicViews[n].removeDocument(t);if(this.adaptiveBinaryIndices&&!c){var h,f=this.binaryIndices;for(h in f)this.adaptiveBinaryIndexRemove(t,h)}else this.flagBinaryIndexesDirty();u&&this.uniqueNames.forEach((function(e){var n=l.getUniqueIndex(e);if(n)for(r=0;r<o;r++)null!==(i=l.data[t[r]])[e]&&void 0!==i[e]&&n.remove(i[e])}))}if(!this.disableChangesApi||this.events.delete.length>1)for(r=0;r<o;r++)this.emit("delete",this.data[t[r]]);if(this.data=this.data.filter((function(t){return!s[t.$loki]})),this.isIncremental)for(r=0;r<o;r++)this.dirtyIds.push(this.idIndex[t[r]]);this.idIndex=this.idIndex.filter((function(t){return!s[t]})),this.adaptiveBinaryIndices&&c&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(t){return this.rollback(),c&&(this.adaptiveBinaryIndices=!0),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),null}},C.prototype.removeBatch=function(t){var e,n=t.length,r=this.data.length,i={},o=[];for(e=0;e<r;e++)i[this.data[e].$loki]=e;for(e=0;e<n;e++)"object"==typeof t[e]?o.push(i[t[e].$loki]):o.push(i[t[e]]);this.removeBatchByPositions(o)},C.prototype.remove=function(e){if("number"==typeof e&&(e=this.get(e)),"object"!=typeof e)throw new Error("Parameter is not an object");if(Array.isArray(e))this.removeBatch(e);else{if(!t.call(e,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();var n=this.get(e.$loki,!0),o=n[1],s=this;this.uniqueNames.forEach((function(t){if(null!==e[t]&&void 0!==e[t]){var n=s.getUniqueIndex(t);n&&n.remove(e[t])}}));for(var a=0;a<this.DynamicViews.length;a++)this.DynamicViews[a].removeDocument(o);if(this.adaptiveBinaryIndices){var u,c=this.binaryIndices;for(u in c)this.adaptiveBinaryIndexRemove(o,u)}else this.flagBinaryIndexesDirty();return this.data.splice(o,1),this.removeAutoUpdateObserver(e),this.idIndex.splice(o,1),this.isIncremental&&this.dirtyIds.push(e.$loki),this.commit(),this.dirty=!0,this.emit("delete",n[0]),this.disableFreeze||(e=i(e)),delete e.$loki,delete e.meta,this.disableFreeze||r(e),e}catch(t){return this.rollback(),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),null}}},C.prototype.get=function(t,e){this.idIndex||this.ensureId();var n=e||!1,r=this.idIndex,i=r.length-1,o=0,s=o+i>>1;if(t="number"==typeof t?t:parseInt(t,10),isNaN(t))throw new TypeError("Passed id is not an integer");for(;r[o]<r[i];)r[s=o+i>>1]<t?o=s+1:i=s;return i===o&&r[o]===t?n?[this.data[o],o]:this.data[o]:null},C.prototype.getBinaryIndexPosition=function(t,e){var n=o.getIn(this.data[t],e,!0),r=this.binaryIndices[e].values,i=this.calculateRange("$eq",e,n);if(0===i[0]&&-1===i[1])return null;for(var s=i[0],a=i[1],u=s;u<=a;u++)if(r[u]===t)return u;return null},C.prototype.adaptiveBinaryIndexInsert=function(t,e){var n=-1!==e.indexOf("."),r=this.binaryIndices[e].values,i=o.getIn(this.data[t],e,n);!0===this.serializableIndices&&i instanceof Date&&(this.data[t][e]=i.getTime(),i=o.getIn(this.data[t],e));var s=0===r.length?0:this.calculateRangeStart(e,i,!0,n);this.binaryIndices[e].values.splice(s,0,t)},C.prototype.adaptiveBinaryIndexUpdate=function(t,e){var n,r=this.binaryIndices[e].values,i=r.length;for(n=0;n<i&&r[n]!==t;n++);this.binaryIndices[e].values.splice(n,1),this.adaptiveBinaryIndexInsert(t,e)},C.prototype.adaptiveBinaryIndexRemove=function(t,e,n){var r,i,o,s,a,u,c,l=this.binaryIndices[e],h={};if(Array.isArray(t)){if(1!==(s=t.length)){for(o=0;o<s;o++)h[t[o]]=!0;if(l.values=l.values.filter((function(t){return!h[t]})),!0===n)return;var f=t.slice();for(f.sort((function(t,e){return t-e})),r=l.values.length,i=0;i<r;i++){for(a=l.values[i],u=0,o=0;o<s&&a>f[o];o++)u++;l.values[i]-=u}return}t=t[0]}if(null===(c=this.getBinaryIndexPosition(t,e)))return null;if(l.values.splice(c,1),!0!==n)for(r=l.values.length,i=0;i<r;i++)l.values[i]>t&&l.values[i]--},C.prototype.calculateRangeStart=function(t,e,n,r){var i=this.data,a=this.binaryIndices[t].values,u=0,c=a.length-1,l=0;if(0===a.length)return-1;for(o.getIn(i[a[u]],t,r),o.getIn(i[a[c]],t,r);u<c;)l=u+c>>1,s.lt(o.getIn(i[a[l]],t,r),e,!1)?u=l+1:c=l;var h=u;return s.aeq(e,o.getIn(i[a[h]],t,r))?h:s.lt(e,o.getIn(i[a[h]],t,r),!1)?n?h:h-1:n?h+1:h},C.prototype.calculateRangeEnd=function(t,e,n){var r=this.data,i=this.binaryIndices[t].values,a=0,u=i.length-1,c=0;if(0===i.length)return-1;for(o.getIn(r[i[a]],t,n),o.getIn(r[i[u]],t,n);a<u;)c=a+u>>1,s.lt(e,o.getIn(r[i[c]],t,n),!1)?u=c:a=c+1;var l=u;return s.aeq(e,o.getIn(r[i[l]],t,n))?l:s.gt(e,o.getIn(r[i[l]],t,n),!1)?l+1:s.aeq(e,o.getIn(r[i[l-1]],t,n))?l-1:l},C.prototype.calculateRange=function(t,e,n){var r,i,a,u=this.data,c=this.binaryIndices[e].values,l=0,h=c.length-1;if(0===u.length)return[0,-1];var f=-1!==e.indexOf("."),d=o.getIn(u[c[l]],e,f),p=o.getIn(u[c[h]],e,f);switch(t){case"$eq":case"$aeq":case"$dteq":if(s.lt(n,d,!1)||s.gt(n,p,!1))return[0,-1];break;case"$gt":if(s.gt(n,p,!0))return[0,-1];if(s.gt(d,n,!1))return[l,h];break;case"$gte":if(s.gt(n,p,!1))return[0,-1];if(s.gt(d,n,!0))return[l,h];break;case"$lt":if(s.lt(n,d,!0))return[0,-1];if(s.lt(p,n,!1))return[l,h];break;case"$lte":if(s.lt(n,d,!1))return[0,-1];if(s.lt(p,n,!0))return[l,h];break;case"$between":return s.gt(n[0],p,!1)||s.lt(n[1],d,!1)?[0,-1]:((r=this.calculateRangeStart(e,n[0],!1,f))<0&&r++,(a=this.calculateRangeEnd(e,n[1],f))>h&&a--,s.gt(o.getIn(u[c[r]],e,f),n[0],!0)||r++,s.lt(o.getIn(u[c[a]],e,f),n[1],!0)||a--,a<r?[0,-1]:[r,a]);case"$in":for(var y=[],v=[],m=0,b=n.length;m<b;m++)for(var g=this.calculateRange("$eq",e,n[m]),w=g[0];w<=g[1];w++)void 0===y[w]&&(y[w]=!0,v.push(w));return v}switch(t){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":r=this.calculateRangeStart(e,n,!1,f),i=o.getIn(u[c[r]],e,f)}switch(t){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":a=this.calculateRangeEnd(e,n,f),o.getIn(u[c[a]],e,f)}switch(t){case"$eq":case"$aeq":case"$dteq":return s.aeq(i,n)?[r,a]:[0,-1];case"$gt":return s.aeq(o.getIn(u[c[a]],e,f),n)?[a+1,h]:[a,h];case"$gte":return s.aeq(o.getIn(u[c[r]],e,f),n)?[r,h]:[r+1,h];case"$lt":return s.aeq(o.getIn(u[c[r]],e,f),n)?[l,r-1]:[l,r];case"$lte":return s.aeq(o.getIn(u[c[a]],e,f),n)?[l,a]:[l,a-1];default:return[0,u.length-1]}},C.prototype.by=function(t,e){var n;if(void 0===e)return n=this,function(e){return n.by(t,e)};var r=this.getUniqueIndex(t,!0).get(e);return this.cloneObjects?m(r,this.cloneMethod):r},C.prototype.findOne=function(t){t=t||{};var e=this.chain().find(t,!0).data();return Array.isArray(e)&&0===e.length?null:this.cloneObjects?m(e[0],this.cloneMethod):e[0]},C.prototype.chain=function(t,e){var n=new P(this);return void 0===t?n:n.transform(t,e)},C.prototype.find=function(t){return this.chain().find(t).data()},C.prototype.findOneUnindexed=function(t,e){for(var n=this.data.length;n--;)if(o.getIn(this.data[n],t,!0)===e)return this.data[n];return null},C.prototype.startTransaction=function(){if(this.transactional){this.cachedData=m(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices,this.cachedDirtyIds=this.dirtyIds;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].startTransaction()}},C.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedDirtyIds=null;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].commit()}},C.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex,this.dirtyIds=this.cachedDirtyIds);for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].rollback()}},C.prototype.async=function(t,e){setTimeout((function(){if("function"!=typeof t)throw new TypeError("Argument passed for async execution is not a function");t(),e()}),0)},C.prototype.where=function(t){return this.chain().where(t).data()},C.prototype.mapReduce=function(t,e){try{return e(this.data.map(t))}catch(t){throw t}},C.prototype.eqJoin=function(t,e,n,r,i){return new P(this).eqJoin(t,e,n,r,i)},C.prototype.stages={},C.prototype.getStage=function(t){return this.stages[t]||(this.stages[t]={}),this.stages[t]},C.prototype.commitLog=[],C.prototype.stage=function(t,e){var n=JSON.parse(JSON.stringify(e));return this.getStage(t)[e.$loki]=n,n},C.prototype.commitStage=function(t,e){var n,r=this.getStage(t),i=(new Date).getTime();for(n in r)this.update(r[n]),this.commitLog.push({timestamp:i,message:e,data:JSON.parse(JSON.stringify(r[n]))});this.stages[t]={}},C.prototype.no_op=function(){},C.prototype.extract=function(t){for(var e=0,n=this.data.length,r=_(t),i=[];e<n;e+=1)i.push(N(this.data[e],t,r));return i},C.prototype.max=function(t){return Math.max.apply(null,this.extract(t))},C.prototype.min=function(t){return Math.min.apply(null,this.extract(t))},C.prototype.maxRecord=function(t){for(var e,n=0,r=this.data.length,i=_(t),o={index:0,value:void 0};n<r;n+=1)void 0!==e?e<N(this.data[n],t,i)&&(e=N(this.data[n],t,i),o.index=this.data[n].$loki):(e=N(this.data[n],t,i),o.index=this.data[n].$loki);return o.value=e,o},C.prototype.minRecord=function(t){for(var e,n=0,r=this.data.length,i=_(t),o={index:0,value:void 0};n<r;n+=1)void 0!==e?e>N(this.data[n],t,i)&&(e=N(this.data[n],t,i),o.index=this.data[n].$loki):(e=N(this.data[n],t,i),o.index=this.data[n].$loki);return o.value=e,o},C.prototype.extractNumerical=function(t){return this.extract(t).map(j).filter(Number).filter((function(t){return!isNaN(t)}))},C.prototype.avg=function(t){return L(this.extractNumerical(t))},C.prototype.stdDev=function(t){return z(this.extractNumerical(t))},C.prototype.mode=function(t){var e,n,r,i={},o=this.extract(t);for(n in o.forEach((function(t){i[t]?i[t]+=1:i[t]=1})),i)e?e<i[n]&&(r=n):(r=n,e=i[n]);return r},C.prototype.median=function(t){var e=this.extractNumerical(t);e.sort(M);var n=Math.floor(e.length/2);return e.length%2?e[n]:(e[n-1]+e[n])/2},q.prototype={keys:[],values:[],sort:function(t,e){return t<e?-1:t>e?1:0},setSort:function(t){this.bs=new $(t)},bs:function(){return new $(this.sort)},set:function(t,e){var n=this.bs(this.keys,t);n.found?this.values[n.index]=e:(this.keys.splice(n.index,0,t),this.values.splice(n.index,0,e))},get:function(t){return this.values[T(this.keys,t,this.sort).index]}},B.prototype.keyMap={},B.prototype.lokiMap={},B.prototype.set=function(t){var e=t[this.field];if(null!=e){if(this.keyMap[e])throw new Error("Duplicate key for property "+this.field+": "+e);this.keyMap[e]=t,this.lokiMap[t.$loki]=e}},B.prototype.get=function(t){return this.keyMap[t]},B.prototype.byId=function(t){return this.keyMap[this.lokiMap[t]]},B.prototype.update=function(t,e){if(this.lokiMap[t.$loki]!==e[this.field]){var n=this.lokiMap[t.$loki];this.set(e),this.keyMap[n]=void 0}else this.keyMap[t[this.field]]=e},B.prototype.remove=function(t){var e=this.keyMap[t];if(null==e)throw new Error("Key is not in unique index: "+this.field);this.keyMap[t]=void 0,this.lokiMap[e.$loki]=void 0},B.prototype.clear=function(){this.keyMap=Object.create(null),this.lokiMap=Object.create(null)},F.prototype={set:function(t,e){this.index[t]?this.index[t].push(e):this.index[t]=[e]},remove:function(t,e){var n=this.index[t];for(var r in n)n[r]==e&&n.splice(r,1);n.length<1&&(this.index[t]=void 0)},get:function(t){return this.index[t]},clear:function(t){this.index={}}},R.prototype={keys:[],values:[],sort:function(t,e){return t<e?-1:t>e?1:0},bs:function(){return new $(this.sort)},setSort:function(t){this.bs=new $(t)},set:function(t,e){var n=T(this.keys,t,this.sort);n.found?this.values[n.index].push(e):(this.keys.splice(n.index,0,t),this.values.splice(n.index,0,[e]))},get:function(t){var e=T(this.keys,t,this.sort);return e.found?this.values[e.index]:[]},getLt:function(t){var e=T(this.keys,t,this.sort),n=e.index;return e.found&&n--,this.getAll(t,0,n)},getGt:function(t){var e=T(this.keys,t,this.sort),n=e.index;return e.found&&n++,this.getAll(t,n,this.keys.length)},getAll:function(t,e,n){for(var r=[],i=e;i<n;i++)r=r.concat(this.values[i]);return r},getPos:function(t){return T(this.keys,t,this.sort)},remove:function(t,e){var n=T(this.keys,t,this.sort).index,r=this.values[n];for(var i in r)r[i]==e&&r.splice(i,1);r.length<1&&(this.keys.splice(n,1),this.values.splice(n,1))},clear:function(){this.keys=[],this.values=[]}},I.deepFreeze=e,I.freeze=r,I.unFreeze=i,I.LokiOps=y,I.Collection=C,I.DynamicView=E,I.Resultset=P,I.KeyValueStore=q,I.LokiMemoryAdapter=k,I.LokiPartitioningAdapter=x,I.LokiLocalStorageAdapter=O,I.LokiFsAdapter=S,I.persistenceAdapters={fs:S,localStorage:O},I.aeq=a,I.lt=u,I.gt=c,I.Comparators=s,I}()},void 0===(o="function"==typeof r?r.apply(e,i):r)||(t.exports=o)},1528:function(t,e){var n,r,i;!function(o,s){"use strict";"object"==typeof t.exports?t.exports=s():(r=[],void 0===(i="function"==typeof(n=s)?n.apply(e,r):n)||(t.exports=i))}(0,(function(){"use strict";var t=Object.prototype.toString;function e(t,e){return null!=t&&Object.prototype.hasOwnProperty.call(t,e)}function n(t){if(!t)return!0;if(i(t)&&0===t.length)return!0;if("string"!=typeof t){for(var n in t)if(e(t,n))return!1;return!0}return!1}function r(e){return t.call(e)}var i=Array.isArray||function(e){return"[object Array]"===t.call(e)};function o(t){var e=parseInt(t);return e.toString()===t?e:t}function s(t){var s,a,u=function(t){return Object.keys(u).reduce((function(e,n){return"create"===n||"function"==typeof u[n]&&(e[n]=u[n].bind(u,t)),e}),{})};function c(t,e){if(s(t,e))return t[e]}function l(t,e,n,r){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if("string"==typeof e)return l(t,e.split(".").map(o),n,r);var i=e[0],s=a(t,i);return 1===e.length?(void 0!==s&&r||(t[i]=n),s):(void 0===s&&("number"==typeof e[1]?t[i]=[]:t[i]={}),l(t[i],e.slice(1),n,r))}return s=(t=t||{}).includeInheritedProps?function(){return!0}:function(t,n){return"number"==typeof n&&Array.isArray(t)||e(t,n)},a=t.includeInheritedProps?function(t,e){"string"!=typeof e&&"number"!=typeof e&&(e=String(e));var n=c(t,e);if("__proto__"===e||"prototype"===e||"constructor"===e&&"function"==typeof n)throw new Error("For security reasons, object's magic properties cannot be set");return n}:function(t,e){return c(t,e)},u.has=function(n,r){if("number"==typeof r?r=[r]:"string"==typeof r&&(r=r.split(".")),!r||0===r.length)return!!n;for(var s=0;s<r.length;s++){var a=o(r[s]);if(!("number"==typeof a&&i(n)&&a<n.length||(t.includeInheritedProps?a in Object(n):e(n,a))))return!1;n=n[a]}return!0},u.ensureExists=function(t,e,n){return l(t,e,n,!0)},u.set=function(t,e,n,r){return l(t,e,n,r)},u.insert=function(t,e,n,r){var o=u.get(t,e);r=~~r,i(o)||(o=[],u.set(t,e,o)),o.splice(r,0,n)},u.empty=function(t,e){var o,a;if(!n(e)&&(null!=t&&(o=u.get(t,e)))){if("string"==typeof o)return u.set(t,e,"");if(function(t){return"boolean"==typeof t||"[object Boolean]"===r(t)}(o))return u.set(t,e,!1);if("number"==typeof o)return u.set(t,e,0);if(i(o))o.length=0;else{if(!function(t){return"object"==typeof t&&"[object Object]"===r(t)}(o))return u.set(t,e,null);for(a in o)s(o,a)&&delete o[a]}}},u.push=function(t,e){var n=u.get(t,e);i(n)||(n=[],u.set(t,e,n)),n.push.apply(n,Array.prototype.slice.call(arguments,2))},u.coalesce=function(t,e,n){for(var r,i=0,o=e.length;i<o;i++)if(void 0!==(r=u.get(t,e[i])))return r;return n},u.get=function(t,e,n){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if(null==t)return n;if("string"==typeof e)return u.get(t,e.split("."),n);var r=o(e[0]),i=a(t,r);return void 0===i?n:1===e.length?i:u.get(t[r],e.slice(1),n)},u.del=function(t,e){if("number"==typeof e&&(e=[e]),null==t)return t;if(n(e))return t;if("string"==typeof e)return u.del(t,e.split("."));var r=o(e[0]);return a(t,r),s(t,r)?1!==e.length?u.del(t[r],e.slice(1)):(i(t)?t.splice(r,1):delete t[r],t):t},u}var a=s();return a.create=s,a.withInheritedProps=s({includeInheritedProps:!0}),a}))},2467:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.serialize=e.deserialize=e.registerSerializer=void 0;const r=n(7381);let i=r.DefaultSerializer;e.registerSerializer=function(t){i=r.extendSerializer(i,t)},e.deserialize=function(t){return i.deserialize(t)},e.serialize=function(t){return i.serialize(t)}},7381:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DefaultSerializer=e.extendSerializer=void 0,e.extendSerializer=function(t,e){const n=t.deserialize.bind(t),r=t.serialize.bind(t);return{deserialize:t=>e.deserialize(t,n),serialize:t=>e.serialize(t,r)}};const n={deserialize:t=>Object.assign(Error(t.message),{name:t.name,stack:t.stack}),serialize:t=>({__error_marker:"$$error",message:t.message,name:t.name,stack:t.stack})};e.DefaultSerializer={deserialize(t){return(e=t)&&"object"==typeof e&&"__error_marker"in e&&"$$error"===e.__error_marker?n.deserialize(t):t;var e},serialize:t=>t instanceof Error?n.serialize(t):t}},8258:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.$worker=e.$transferable=e.$terminate=e.$events=e.$errors=void 0,e.$errors=Symbol("thread.errors"),e.$events=Symbol("thread.events"),e.$terminate=Symbol("thread.terminate"),e.$transferable=Symbol("thread.transferable"),e.$worker=Symbol("thread.worker")},8180:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Transfer=e.isTransferDescriptor=void 0;const r=n(8258);e.isTransferDescriptor=function(t){return t&&"object"==typeof t&&t[r.$transferable]},e.Transfer=function(t,e){if(!e){if(!(n=t)||"object"!=typeof n)throw Error();e=[t]}var n;return{[r.$transferable]:!0,send:t,transferables:e}}},3229:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WorkerMessageType=e.MasterMessageType=void 0,function(t){t.cancel="cancel",t.run="run"}(e.MasterMessageType||(e.MasterMessageType={})),function(t){t.error="error",t.init="init",t.result="result",t.running="running",t.uncaughtError="uncaughtError"}(e.WorkerMessageType||(e.WorkerMessageType={}))},3447:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={isWorkerRuntime:function(){const t="undefined"!=typeof self&&"undefined"!=typeof Window&&self instanceof Window;return!("undefined"==typeof self||!self.postMessage||t)},postMessageToMaster:function(t,e){self.postMessage(t,e)},subscribeToMasterMessages:function(t){const e=e=>{t(e.data)};return self.addEventListener("message",e),()=>{self.removeEventListener("message",e)}}}},1934:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.expose=e.isWorkerRuntime=e.Transfer=e.registerSerializer=void 0;const o=i(n(6898)),s=n(2467),a=n(8180),u=n(3229),c=i(n(3447));var l=n(2467);Object.defineProperty(e,"registerSerializer",{enumerable:!0,get:function(){return l.registerSerializer}});var h=n(8180);Object.defineProperty(e,"Transfer",{enumerable:!0,get:function(){return h.Transfer}}),e.isWorkerRuntime=c.default.isWorkerRuntime;let f=!1;const d=new Map,p=t=>t&&t.type===u.MasterMessageType.run,y=t=>o.default(t)||function(t){return t&&"object"==typeof t&&"function"==typeof t.subscribe}(t);function v(t){return a.isTransferDescriptor(t)?{payload:t.send,transferables:t.transferables}:{payload:t,transferables:void 0}}function m(t,e){const{payload:n,transferables:r}=v(e),i={type:u.WorkerMessageType.error,uid:t,error:s.serialize(n)};c.default.postMessageToMaster(i,r)}function b(t,e,n){const{payload:r,transferables:i}=v(n),o={type:u.WorkerMessageType.result,uid:t,complete:!!e||void 0,payload:r};c.default.postMessageToMaster(o,i)}function g(t){try{const e={type:u.WorkerMessageType.uncaughtError,error:s.serialize(t)};c.default.postMessageToMaster(e)}catch(e){console.error("Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.\nLatest error:",e,"\nOriginal error:",t)}}function w(t,e,n){return r(this,void 0,void 0,(function*(){let r;try{r=e(...n)}catch(e){return m(t,e)}const i=y(r)?"observable":"promise";if(function(t,e){const n={type:u.WorkerMessageType.running,uid:t,resultType:e};c.default.postMessageToMaster(n)}(t,i),y(r)){const e=r.subscribe((e=>b(t,!1,s.serialize(e))),(e=>{m(t,s.serialize(e)),d.delete(t)}),(()=>{b(t,!0),d.delete(t)}));d.set(t,e)}else try{const e=yield r;b(t,!0,s.serialize(e))}catch(e){m(t,s.serialize(e))}}))}e.expose=function(t){if(!c.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(f)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(f=!0,"function"==typeof t)c.default.subscribeToMasterMessages((e=>{p(e)&&!e.method&&w(e.uid,t,e.args.map(s.deserialize))})),function(){const t={type:u.WorkerMessageType.init,exposed:{type:"function"}};c.default.postMessageToMaster(t)}();else{if("object"!=typeof t||!t)throw Error(`Invalid argument passed to expose(). Expected a function or an object, got: ${t}`);c.default.subscribeToMasterMessages((e=>{p(e)&&e.method&&w(e.uid,t[e.method],e.args.map(s.deserialize))}));!function(t){const e={type:u.WorkerMessageType.init,exposed:{type:"module",methods:t}};c.default.postMessageToMaster(e)}(Object.keys(t).filter((e=>"function"==typeof t[e])))}c.default.subscribeToMasterMessages((t=>{if((e=t)&&e.type===u.MasterMessageType.cancel){const e=t.uid,n=d.get(e);n&&(n.unsubscribe(),d.delete(e))}var e}))},"undefined"!=typeof self&&"function"==typeof self.addEventListener&&c.default.isWorkerRuntime()&&(self.addEventListener("error",(t=>{setTimeout((()=>g(t.error||t)),250)})),self.addEventListener("unhandledrejection",(t=>{const e=t.reason;e&&"string"==typeof e.message&&setTimeout((()=>g(e)),250)}))),"undefined"!=typeof process&&"function"==typeof process.on&&c.default.isWorkerRuntime()&&(process.on("uncaughtException",(t=>{setTimeout((()=>g(t)),250)})),process.on("unhandledRejection",(t=>{t&&"string"==typeof t.message&&setTimeout((()=>g(t)),250)})))},693:()=>{},199:()=>{},7061:(t,e,n)=>{var r=n(8698).default;function i(){"use strict";t.exports=i=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var e={},n=Object.prototype,o=n.hasOwnProperty,s=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},u=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function f(t,e,n,r){var i=e&&e.prototype instanceof y?e:y,o=Object.create(i.prototype),a=new E(r||[]);return s(o,"_invoke",{value:S(t,n,a)}),o}function d(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var p={};function y(){}function v(){}function m(){}var b={};h(b,u,(function(){return this}));var g=Object.getPrototypeOf,w=g&&g(g(C([])));w&&w!==n&&o.call(w,u)&&(b=w);var I=m.prototype=y.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(i,s,a,u){var c=d(t[i],t,s);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==r(h)&&o.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,u)}))}u(c.arg)}var i;s(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}})}function S(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return _()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=O(s,n);if(a){if(a===p)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=d(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===p)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function O(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,O(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var i=d(r,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function D(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function C(t){if(t){var e=t[u];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(o.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:_}}function _(){return{value:void 0,done:!0}}return v.prototype=m,s(I,"constructor",{value:m,configurable:!0}),s(m,"constructor",{value:v,configurable:!0}),v.displayName=h(m,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,h(t,l,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},k(x.prototype),h(x.prototype,c,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new x(f(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},k(I),h(I,l,"Generator"),h(I,u,(function(){return this})),h(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=C,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(D),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return s.type="throw",s.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],s=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var a=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(a&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=t,s.arg=e,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),D(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;D(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:C(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},e}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},8698:t=>{function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},4687:(t,e,n)=>{var r=n(7061)();t.exports=r;try{regeneratorRuntime=r}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,n),o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=n(3050),e=n.n(t);function r(t){return Object.assign({},t)}function i(t){if(!t)throw new Error("ensureNotFalsy() is falsy");return t}function o(t,e){var n=t.get(e);if(void 0===n)throw new Error("missing value from map "+e);return n}function s(t,e,n,r,i,o,s){try{var a=t[o](s),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,i)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){s(o,r,i,a,u,"next",t)}function u(t){s(o,r,i,a,u,"throw",t)}a(void 0)}))}}var u=n(4687),c=n.n(u),l=function(t,e){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},l(t,e)};function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function f(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function d(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}Object.create;function p(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function v(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function m(t){return this instanceof m?(this.v=t,this):new m(t)}function b(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){o.push([t,e,n,r])>1||a(t,e)}))})}function a(t,e){try{(n=i[t](e)).value instanceof m?Promise.resolve(n.value.v).then(u,c):l(o[0][2],n)}catch(t){l(o[0][3],t)}var n}function u(t){a("next",t)}function c(t){a("throw",t)}function l(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1])}}function g(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=p(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,i,(e=t[n](e)).done,e.value)}))}}}Object.create;function w(t){return"function"==typeof t}function I(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var k=I((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function x(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var S=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}var e;return t.prototype.unsubscribe=function(){var t,e,n,r,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=p(o),a=s.next();!a.done;a=s.next()){a.value.remove(this)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}else o.remove(this);var u=this.initialTeardown;if(w(u))try{u()}catch(t){i=t instanceof k?t.errors:[t]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var l=p(c),h=l.next();!h.done;h=l.next()){var f=h.value;try{D(f)}catch(t){i=null!=i?i:[],t instanceof k?i=v(v([],y(i)),y(t.errors)):i.push(t)}}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}if(i)throw new k(i)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)D(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&x(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&x(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}(),O=S.EMPTY;function P(t){return t instanceof S||t&&"closed"in t&&w(t.remove)&&w(t.add)&&w(t.unsubscribe)}function D(t){w(t)?t():t.unsubscribe()}var E={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},C={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=C.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,v([t,e],y(n))):setTimeout.apply(void 0,v([t,e],y(n)))},clearTimeout:function(t){var e=C.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function _(t){C.setTimeout((function(){var e=E.onUnhandledError;if(!e)throw t;e(t)}))}function j(){}var A=M("C",void 0,void 0);function M(t,e,n){return{kind:t,value:e,error:n}}var L=null;function z(t){if(E.useDeprecatedSynchronousErrorHandling){var e=!L;if(e&&(L={errorThrown:!1,error:null}),t(),e){var n=L,r=n.errorThrown,i=n.error;if(L=null,r)throw i}}else t()}var N=function(t){function e(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,P(e)&&e.add(n)):n.destination=V,n}return h(e,t),e.create=function(t,e,n){return new B(t,e,n)},e.prototype.next=function(t){this.isStopped?R(function(t){return M("N",t,void 0)}(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?R(M("E",void 0,t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?R(A,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(S),T=Function.prototype.bind;function $(t,e){return T.call(t,e)}var q=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){F(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){F(t)}else F(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){F(t)}},t}(),B=function(t){function e(e,n,r){var i,o,s=t.call(this)||this;w(e)||!e?i={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&E.useDeprecatedNextContext?((o=Object.create(e)).unsubscribe=function(){return s.unsubscribe()},i={next:e.next&&$(e.next,o),error:e.error&&$(e.error,o),complete:e.complete&&$(e.complete,o)}):i=e;return s.destination=new q(i),s}return h(e,t),e}(N);function F(t){var e;E.useDeprecatedSynchronousErrorHandling?(e=t,E.useDeprecatedSynchronousErrorHandling&&L&&(L.errorThrown=!0,L.error=e)):_(t)}function R(t,e){var n=E.onStoppedNotification;n&&C.setTimeout((function(){return n(t,e)}))}var V={closed:!0,next:j,error:function(t){throw t},complete:j},W="function"==typeof Symbol&&Symbol.observable||"@@observable";function J(t){return t}function K(t){return 0===t.length?J:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var U=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r,i=this,o=(r=t)&&r instanceof N||function(t){return t&&w(t.next)&&w(t.error)&&w(t.complete)}(r)&&P(r)?t:new B(t,e,n);return z((function(){var t=i,e=t.operator,n=t.source;o.add(e?e.call(o,n):n?i._subscribe(o):i._trySubscribe(o))})),o},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=Q(e))((function(e,r){var i=new B({next:function(e){try{t(e)}catch(t){r(t),i.unsubscribe()}},error:r,complete:e});n.subscribe(i)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[W]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return K(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=Q(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function Q(t){var e;return null!==(e=null!=t?t:E.Promise)&&void 0!==e?e:Promise}var G=I((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),H=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return h(e,t),e.prototype.lift=function(t){var e=new Y(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new G},e.prototype.next=function(t){var e=this;z((function(){var n,r;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var i=p(e.currentObservers),o=i.next();!o.done;o=i.next()){o.value.next(t)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},e.prototype.error=function(t){var e=this;z((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var n=e.observers;n.length;)n.shift().error(t)}}))},e.prototype.complete=function(){var t=this;z((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,n=this,r=n.hasError,i=n.isStopped,o=n.observers;return r||i?O:(this.currentObservers=null,o.push(t),new S((function(){e.currentObservers=null,x(o,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this,n=e.hasError,r=e.thrownError,i=e.isStopped;n?t.error(r):i&&t.complete()},e.prototype.asObservable=function(){var t=new U;return t.source=this,t},e.create=function(t,e){return new Y(t,e)},e}(U),Y=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return h(e,t),e.prototype.next=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)},e.prototype.error=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:O},e}(H),X=0;function Z(){var t=(new Date).getTime();(t+=.01)<=X&&(t=X+.01);var e=parseFloat(t.toFixed(2));return X=e,e}function tt(t){return function(e,n){return e._meta.lwt===n._meta.lwt?n[t]<e[t]?1:-1:e._meta.lwt-n._meta.lwt}}function et(t){return Array.isArray(t)}function nt(t){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(t)}function rt(t){var e=function(t,e){if("object"!==nt(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==nt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===nt(e)?e:String(e)}function it(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,rt(r.key),r)}}function ot(t,e,n){return e&&it(t.prototype,e),n&&it(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function st(t,e){return st=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},st(t,e)}function at(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,st(t,e)}function ut(t){return ut=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ut(t)}function ct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function lt(t,e,n){return lt=ct()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&st(i,n.prototype),i},lt.apply(null,arguments)}function ht(t){var e="function"==typeof Map?new Map:void 0;return ht=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return lt(t,arguments,ut(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),st(r,t)},ht(t)}var ft=function(t){return"RxDB Error-Code "+t+".\n        Error messages are not included in RxDB core to reduce build size.\n        - To find out what this error means, either use the dev-mode-plugin https://rxdb.info/dev-mode.html\n        - or search for the error code here: https://github.com/pubkey/rxdb/search?q="+t+"\n        "};function dt(t,e,n){return"RxError ("+e+"):\n"+t+"\n"+function(t){var e="";return 0===Object.keys(t).length?e:(e+="Given parameters: {\n",e+=Object.keys(t).map((function(e){var n="[object Object]";try{n=JSON.stringify(t[e],(function(t,e){return void 0===e?null:e}),2)}catch(t){}return e+":"+n})).join("\n"),e+="}")}(n)}var pt=function(t){function e(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=dt(n,e,i);return(r=t.call(this,o)||this).code=e,r.message=o,r.parameters=i,r.rxdb=!0,r}return at(e,t),e.prototype.toString=function(){return this.message},ot(e,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}]),e}(ht(Error));TypeError;function yt(t,e){return new pt(t,ft(t),e)}var vt=n(5643),mt=n.n(vt);const bt={add:function(t){if("function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope);else{if("function"!=typeof window.addEventListener)return;window.addEventListener("beforeunload",(function(){t()}),!0),window.addEventListener("unload",(function(){t()}),!0)}}};var gt=n(199),wt=n.n(gt),It=mt()?wt():bt,kt=new Set,xt=!1;function St(t){if(xt||(xt=!0,It.add(Ot)),"function"!=typeof t)throw new Error("Listener is no function");return kt.add(t),{remove:function(){return kt.delete(t)},run:function(){return kt.delete(t),t()}}}function Ot(){var t=[];return kt.forEach((function(e){t.push(e()),kt.delete(e)})),Promise.all(t)}function Pt(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e="",n="abcdefghijklmnopqrstuvwxyz",r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}function Dt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(e){return setTimeout(e,t)}))}Promise.resolve(!0),Promise.resolve(!1),Promise.resolve(null);var Et=Promise.resolve();function Ct(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"object"==typeof window&&window.requestIdleCallback?new Promise((function(e){return window.requestIdleCallback(e,{timeout:t})})):Dt(0)}var _t=function(){function t(t,e){this.writesSinceLastRun=0,this.saveQueue=Et,this.saveQueueC=0,this.lokiDatabase=t,this.databaseSettings=e}var e=t.prototype;return e.addWrite=function(){this.writesSinceLastRun=this.writesSinceLastRun+1,this.run()},e.run=function(){var t=this;return!this.databaseSettings.adapter||this.saveQueueC>2||(this.saveQueueC=this.saveQueueC+1,this.saveQueue=this.saveQueue.then(a(c().mark((function e(){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ct();case 2:if(0!==t.writesSinceLastRun){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,Ct().then((function(){return Ct()}));case 6:if(0!==t.writesSinceLastRun){e.next=8;break}return e.abrupt("return");case 8:return n=t.writesSinceLastRun,t.writesSinceLastRun=0,e.abrupt("return",new Promise((function(e,r){t.lokiDatabase.saveDatabase((function(i){i?(t.writesSinceLastRun=t.writesSinceLastRun+n,r(i)):(t.databaseSettings.autosaveCallback&&t.databaseSettings.autosaveCallback(),e())}))})));case 11:case"end":return e.stop()}}),e)})))).catch((function(){})).then((function(){t.saveQueueC=t.saveQueueC-1}))),this.saveQueue},t}(),jt=n(1528),At=n.n(jt);function Mt(t){return function(e){if(function(t){return w(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}var Lt=Array.isArray;function zt(t){return 1===t.length&&Lt(t[0])?t[0]:t}function Nt(t,e,n,r,i){return new Tt(t,e,n,r,i)}var Tt=function(t){function e(e,n,r,i,o,s){var a=t.call(this,e)||this;return a.onFinalize=o,a.shouldUnsubscribe=s,a._next=n?function(t){try{n(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=i?function(t){try{i(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=r?function(){try{r()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return h(e,t),e.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},e}(N);var $t=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function qt(t){return w(null==t?void 0:t.then)}function Bt(t){return w(t[W])}function Ft(t){return Symbol.asyncIterator&&w(null==t?void 0:t[Symbol.asyncIterator])}function Rt(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Vt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Wt(t){return w(null==t?void 0:t[Vt])}function Jt(t){return b(this,arguments,(function(){var e,n,r;return d(this,(function(i){switch(i.label){case 0:e=t.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,m(e.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,m(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,m(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}}))}))}function Kt(t){return w(null==t?void 0:t.getReader)}function Ut(t){if(t instanceof U)return t;if(null!=t){if(Bt(t))return i=t,new U((function(t){var e=i[W]();if(w(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if($t(t))return r=t,new U((function(t){for(var e=0;e<r.length&&!t.closed;e++)t.next(r[e]);t.complete()}));if(qt(t))return n=t,new U((function(t){n.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,_)}));if(Ft(t))return Qt(t);if(Wt(t))return e=t,new U((function(t){var n,r;try{for(var i=p(e),o=i.next();!o.done;o=i.next()){var s=o.value;if(t.next(s),t.closed)return}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}t.complete()}));if(Kt(t))return Qt(Jt(t))}var e,n,r,i;throw Rt(t)}function Qt(t){return new U((function(e){(function(t,e){var n,r,i,o;return f(this,void 0,void 0,(function(){var s,a;return d(this,(function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),n=g(t),u.label=1;case 1:return[4,n.next()];case 2:if((r=u.sent()).done)return[3,4];if(s=r.value,e.next(s),e.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=u.sent(),i={error:a},[3,11];case 6:return u.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}}))}))})(t,e).catch((function(t){return e.error(t)}))}))}function Gt(t,e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var o=e.schedule((function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()}),r);if(t.add(o),!i)return o}function Ht(t,e,n){return void 0===n&&(n=1/0),w(e)?Ht((function(n,r){return function(t,e){return Mt((function(n,r){var i=0;n.subscribe(Nt(r,(function(n){r.next(t.call(e,n,i++))})))}))}((function(t,i){return e(n,t,r,i)}))(Ut(t(n,r)))}),n):("number"==typeof e&&(n=e),Mt((function(e,r){return function(t,e,n,r,i,o,s,a){var u=[],c=0,l=0,h=!1,f=function(){!h||u.length||c||e.complete()},d=function(t){return c<r?p(t):u.push(t)},p=function(t){o&&e.next(t),c++;var a=!1;Ut(n(t,l++)).subscribe(Nt(e,(function(t){null==i||i(t),o?d(t):e.next(t)}),(function(){a=!0}),void 0,(function(){if(a)try{c--;for(var t=function(){var t=u.shift();s?Gt(e,s,(function(){return p(t)})):p(t)};u.length&&c<r;)t();f()}catch(t){e.error(t)}})))};return t.subscribe(Nt(e,d,(function(){h=!0,f()}))),function(){null==a||a()}}(e,r,t,n)})))}function Yt(t){return void 0===t&&(t=1/0),Ht(J,t)}function Xt(t){return t[t.length-1]}function Zt(t){return(e=Xt(t))&&w(e.schedule)?t.pop():void 0;var e}function te(t,e){return"number"==typeof Xt(t)?t.pop():e}function ee(t,e){return void 0===e&&(e=0),Mt((function(n,r){n.subscribe(Nt(r,(function(n){return Gt(r,t,(function(){return r.next(n)}),e)}),(function(){return Gt(r,t,(function(){return r.complete()}),e)}),(function(n){return Gt(r,t,(function(){return r.error(n)}),e)})))}))}function ne(t,e){return void 0===e&&(e=0),Mt((function(n,r){r.add(t.schedule((function(){return n.subscribe(r)}),e))}))}function re(t,e){if(!t)throw new Error("Iterable cannot be null");return new U((function(n){Gt(n,e,(function(){var r=t[Symbol.asyncIterator]();Gt(n,e,(function(){r.next().then((function(t){t.done?n.complete():n.next(t.value)}))}),0,!0)}))}))}function ie(t,e){if(null!=t){if(Bt(t))return function(t,e){return Ut(t).pipe(ne(e),ee(e))}(t,e);if($t(t))return function(t,e){return new U((function(n){var r=0;return e.schedule((function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())}))}))}(t,e);if(qt(t))return function(t,e){return Ut(t).pipe(ne(e),ee(e))}(t,e);if(Ft(t))return re(t,e);if(Wt(t))return function(t,e){return new U((function(n){var r;return Gt(n,e,(function(){r=t[Vt](),Gt(n,e,(function(){var t,e,i;try{e=(t=r.next()).value,i=t.done}catch(t){return void n.error(t)}i?n.complete():n.next(e)}),0,!0)})),function(){return w(null==r?void 0:r.return)&&r.return()}}))}(t,e);if(Kt(t))return function(t,e){return re(Jt(t),e)}(t,e)}throw Rt(t)}function oe(t,e){return e?ie(t,e):Ut(t)}function se(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Zt(t),r=te(t,1/0);return t=zt(t),Mt((function(e,i){Yt(r)(oe(v([e],y(t)),n)).subscribe(i)}))}Promise.resolve(!1);var ae=Promise.resolve(!0),ue=Promise.resolve();function ce(t,e){return t||(t=0),new Promise((function(n){return setTimeout((function(){return n(e)}),t)}))}function le(){return Math.random().toString(36).substring(2)}var he=0,fe=0;function de(){var t=(new Date).getTime();return t===he?1e3*t+ ++fe:(he=t,fe=0,1e3*t)}var pe={create:function(t){var e={messagesCallback:null,bc:new BroadcastChannel(t),subFns:[]};return e.bc.onmessage=function(t){e.messagesCallback&&e.messagesCallback(t.data)},e},close:function(t){t.bc.close(),t.subFns=[]},onMessage:function(t,e){t.messagesCallback=e},postMessage:function(t,e){try{return t.bc.postMessage(e,!1),ue}catch(t){return Promise.reject(t)}},canBeUsed:function(){if("undefined"==typeof window)return!1;if("function"==typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1},type:"native",averageResponseTime:function(){return 150},microSeconds:de},ye=function(){function t(t){this.ttl=t,this.map=new Map,this._to=!1}return t.prototype.has=function(t){return this.map.has(t)},t.prototype.add=function(t){var e=this;this.map.set(t,ve()),this._to||(this._to=!0,setTimeout((function(){e._to=!1,function(t){var e=ve()-t.ttl,n=t.map[Symbol.iterator]();for(;;){var r=n.next().value;if(!r)return;var i=r[0];if(!(r[1]<e))return;t.map.delete(i)}}(e)}),0))},t.prototype.clear=function(){this.map.clear()},t}();function ve(){return(new Date).getTime()}function me(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=JSON.parse(JSON.stringify(t));return void 0===e.webWorkerSupport&&(e.webWorkerSupport=!0),e.idb||(e.idb={}),e.idb.ttl||(e.idb.ttl=45e3),e.idb.fallbackInterval||(e.idb.fallbackInterval=150),t.idb&&"function"==typeof t.idb.onclose&&(e.idb.onclose=t.idb.onclose),e.localstorage||(e.localstorage={}),e.localstorage.removeTimeout||(e.localstorage.removeTimeout=6e4),t.methods&&(e.methods=t.methods),e.node||(e.node={}),e.node.ttl||(e.node.ttl=12e4),e.node.maxParallelWrites||(e.node.maxParallelWrites=2048),void 0===e.node.useFastPath&&(e.node.useFastPath=!0),e}var be="messages",ge={durability:"relaxed"};function we(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function Ie(t){t.commit&&t.commit()}function ke(t,e){var n=t.transaction(be,"readonly",ge),r=n.objectStore(be),i=[],o=IDBKeyRange.bound(e+1,1/0);if(r.getAll){var s=r.getAll(o);return new Promise((function(t,e){s.onerror=function(t){return e(t)},s.onsuccess=function(e){t(e.target.result)}}))}return new Promise((function(t,s){var a=function(){try{return o=IDBKeyRange.bound(e+1,1/0),r.openCursor(o)}catch(t){return r.openCursor()}}();a.onerror=function(t){return s(t)},a.onsuccess=function(r){var o=r.target.result;o?o.value.id<e+1?o.continue(e+1):(i.push(o.value),o.continue()):(Ie(n),t(i))}}))}function xe(t){return(e=t.db,n=t.options.idb.ttl,r=(new Date).getTime()-n,i=e.transaction(be,"readonly",ge),o=i.objectStore(be),s=[],new Promise((function(t){o.openCursor().onsuccess=function(e){var n=e.target.result;if(n){var o=n.value;o.time<r?(s.push(o),n.continue()):(Ie(i),t(s))}else t(s)}}))).then((function(e){return function(t,e){if(t.closed)return Promise.resolve([]);var n=t.db.transaction(be,"readwrite",ge).objectStore(be);return Promise.all(e.map((function(t){var e=n.delete(t);return new Promise((function(t){e.onsuccess=function(){return t()}}))})))}(t,e.map((function(t){return t.id})))}));var e,n,r,i,o,s}function Se(t){t.closed||Oe(t).then((function(){return ce(t.options.idb.fallbackInterval)})).then((function(){return Se(t)}))}function Oe(t){return t.closed?ue:t.messagesCallback?ke(t.db,t.lastCursorId).then((function(e){var n=e.filter((function(t){return!!t})).map((function(e){return e.id>t.lastCursorId&&(t.lastCursorId=e.id),e})).filter((function(e){return function(t,e){return!(t.uuid===e.uuid||e.eMIs.has(t.id)||t.data.time<e.messagesCallbackTime)}(e,t)})).sort((function(t,e){return t.time-e.time}));return n.forEach((function(e){t.messagesCallback&&(t.eMIs.add(e.id),t.messagesCallback(e.data))})),ue})):ue}var Pe={create:function(t,e){return e=me(e),function(t){var e="pubkey.broadcast-channel-0-"+t,n=we().open(e);return n.onupgradeneeded=function(t){t.target.result.createObjectStore(be,{keyPath:"id",autoIncrement:!0})},new Promise((function(t,e){n.onerror=function(t){return e(t)},n.onsuccess=function(){t(n.result)}}))}(t).then((function(n){var r={closed:!1,lastCursorId:0,channelName:t,options:e,uuid:le(),eMIs:new ye(2*e.idb.ttl),writeBlockPromise:ue,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){r.closed=!0,e.idb.onclose&&e.idb.onclose()},Se(r),r}))},close:function(t){t.closed=!0,t.db.close()},onMessage:function(t,e,n){t.messagesCallbackTime=n,t.messagesCallback=e,Oe(t)},postMessage:function(t,e){return t.writeBlockPromise=t.writeBlockPromise.then((function(){return function(t,e,n){var r={uuid:e,time:(new Date).getTime(),data:n},i=t.transaction([be],"readwrite",ge);return new Promise((function(t,e){i.oncomplete=function(){return t()},i.onerror=function(t){return e(t)},i.objectStore(be).add(r),Ie(i)}))}(t.db,t.uuid,e)})).then((function(){var e,n;0===(e=0,n=10,Math.floor(Math.random()*(n-e+1)+e))&&xe(t)})),t.writeBlockPromise},canBeUsed:function(){return!!we()},type:"idb",averageResponseTime:function(t){return 2*t.idb.fallbackInterval},microSeconds:de};function De(){var t;if("undefined"==typeof window)return null;try{t=window.localStorage,t=window["ie8-eventlistener/storage"]||window.localStorage}catch(t){}return t}function Ee(t){return"pubkey.broadcastChannel-"+t}function Ce(){var t=De();if(!t)return!1;try{var e="__broadcastchannel_check";t.setItem(e,"works"),t.removeItem(e)}catch(t){return!1}return!0}var _e={create:function(t,e){if(e=me(e),!Ce())throw new Error("BroadcastChannel: localstorage cannot be used");var n=le(),r=new ye(e.localstorage.removeTimeout),i={channelName:t,uuid:n,eMIs:r};return i.listener=function(t,e){var n=Ee(t),r=function(t){t.key===n&&e(JSON.parse(t.newValue))};return window.addEventListener("storage",r),r}(t,(function(t){i.messagesCallback&&t.uuid!==n&&t.token&&!r.has(t.token)&&(t.data.time&&t.data.time<i.messagesCallbackTime||(r.add(t.token),i.messagesCallback(t.data)))})),i},close:function(t){var e;e=t.listener,window.removeEventListener("storage",e)},onMessage:function(t,e,n){t.messagesCallbackTime=n,t.messagesCallback=e},postMessage:function(t,e){return new Promise((function(n){ce().then((function(){var r=Ee(t.channelName),i={token:le(),time:(new Date).getTime(),data:e,uuid:t.uuid},o=JSON.stringify(i);De().setItem(r,o);var s=document.createEvent("Event");s.initEvent("storage",!0,!0),s.key=r,s.newValue=o,window.dispatchEvent(s),n()}))}))},canBeUsed:Ce,type:"localstorage",averageResponseTime:function(){var t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?240:120},microSeconds:de},je=de,Ae=new Set;var Me={create:function(t){var e={name:t,messagesCallback:null};return Ae.add(e),e},close:function(t){Ae.delete(t)},onMessage:function(t,e){t.messagesCallback=e},postMessage:function(t,e){return new Promise((function(n){return setTimeout((function(){Array.from(Ae).filter((function(e){return e.name===t.name})).filter((function(e){return e!==t})).filter((function(t){return!!t.messagesCallback})).forEach((function(t){return t.messagesCallback(e)})),n()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:je},Le=[pe,Pe,_e];var ze,Ne=new Set,Te=0,$e=function(t,e){var n,r,i;this.id=Te++,Ne.add(this),this.name=t,ze&&(e=ze),this.options=me(e),this.method=function(t){var e=[].concat(t.methods,Le).filter(Boolean);if(t.type){if("simulate"===t.type)return Me;var n=e.find((function(e){return e.type===t.type}));if(n)return n;throw new Error("method-type "+t.type+" not found")}t.webWorkerSupport||(e=e.filter((function(t){return"idb"!==t.type})));var r=e.find((function(t){return t.canBeUsed()}));if(r)return r;throw new Error("No usable method found in "+JSON.stringify(Le.map((function(t){return t.type}))))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,r=(n=this).method.create(n.name,n.options),(i=r)&&"function"==typeof i.then?(n._prepP=r,r.then((function(t){n._state=t}))):n._state=r};function qe(t,e,n){var r={time:t.method.microSeconds(),type:e,data:n};return(t._prepP?t._prepP:ue).then((function(){var e=t.method.postMessage(t._state,r);return t._uMP.add(e),e.catch().then((function(){return t._uMP.delete(e)})),e}))}function Be(t){return t._addEL.message.length>0||t._addEL.internal.length>0}function Fe(t,e,n){t._addEL[e].push(n),function(t){if(!t._iL&&Be(t)){var e=function(e){t._addEL[e.type].forEach((function(t){var n=1e5,r=t.time-n;e.time>=r&&t.fn(e.data)}))},n=t.method.microSeconds();t._prepP?t._prepP.then((function(){t._iL=!0,t.method.onMessage(t._state,e,n)})):(t._iL=!0,t.method.onMessage(t._state,e,n))}}(t)}function Re(t,e,n){t._addEL[e]=t._addEL[e].filter((function(t){return t!==n})),function(t){if(t._iL&&!Be(t)){t._iL=!1;var e=t.method.microSeconds();t.method.onMessage(t._state,null,e)}}(t)}$e._pubkey=!0,$e.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(t));return qe(this,"message",t)},postInternal:function(t){return qe(this,"internal",t)},set onmessage(t){var e={time:this.method.microSeconds(),fn:t};Re(this,"message",this._onML),t&&"function"==typeof t?(this._onML=e,Fe(this,"message",e)):this._onML=null},addEventListener:function(t,e){Fe(this,t,{time:this.method.microSeconds(),fn:e})},removeEventListener:function(t,e){Re(this,t,this._addEL[t].find((function(t){return t.fn===e})))},close:function(){var t=this;if(!this.closed){Ne.delete(this),this.closed=!0;var e=this._prepP?this._prepP:ue;return this._onML=null,this._addEL.message=[],e.then((function(){return Promise.all(Array.from(t._uMP))})).then((function(){return Promise.all(t._befC.map((function(t){return t()})))})).then((function(){return t.method.close(t._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}};var Ve="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)?function(t){process.on("exit",(function(){return t()})),process.on("beforeExit",(function(){return t().then((function(){return process.exit()}))})),process.on("SIGINT",(function(){return t().then((function(){return process.exit()}))})),process.on("uncaughtException",(function(e){return t().then((function(){console.trace(e),process.exit(101)}))}))}:function(t){if("function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){var e=self.close.bind(self);self.close=function(){return t(),e()}}else{if("function"!=typeof window.addEventListener)return;window.addEventListener("beforeunload",(function(){t()}),!0),window.addEventListener("unload",(function(){t()}),!0)}},We=new Set,Je=!1;function Ke(t){if(Je||(Je=!0,Ve(Ue)),"function"!=typeof t)throw new Error("Listener is no function");return We.add(t),{remove:function(){return We.delete(t)},run:function(){return We.delete(t),t()}}}function Ue(){var t=[];return We.forEach((function(e){t.push(e()),We.delete(e)})),Promise.all(t)}var Qe=function(t,e){var n=this;this.broadcastChannel=t,this._options=e,this.isLeader=!1,this.hasLeader=!1,this.isDead=!1,this.token=le(),this._aplQ=ue,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var r=function(t){"leader"===t.context&&("death"===t.action&&(n.hasLeader=!1),"tell"===t.action&&(n.hasLeader=!0))};this.broadcastChannel.addEventListener("internal",r),this._lstns.push(r)};function Ge(t,e){var n={context:"leader",action:e,token:t.token};return t.broadcastChannel.postInternal(n)}function He(t,e){if(t._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");e=function(t,e){return t||(t={}),(t=JSON.parse(JSON.stringify(t))).fallbackInterval||(t.fallbackInterval=3e3),t.responseTime||(t.responseTime=e.method.averageResponseTime(e.options)),t}(e,t);var n=new Qe(t,e);return t._befC.push((function(){return n.die()})),t._leaderElector=n,n}Qe.prototype={applyOnce:function(t){var e=this;if(this.isLeader)return ce(0,!0);if(this.isDead)return ce(0,!1);if(this._aplQC>1)return this._aplQ;var n=function(){if(e.isLeader)return ae;var n,r=!1,i=new Promise((function(t){n=function(){r=!0,t()}})),o=function(t){"leader"===t.context&&t.token!=e.token&&("apply"===t.action&&t.token>e.token&&n(),"tell"===t.action&&(n(),e.hasLeader=!0))};e.broadcastChannel.addEventListener("internal",o);var s=t?4*e._options.responseTime:e._options.responseTime;return Ge(e,"apply").then((function(){return Promise.race([ce(s),i.then((function(){return Promise.reject(new Error)}))])})).then((function(){return Ge(e,"apply")})).then((function(){return Promise.race([ce(s),i.then((function(){return Promise.reject(new Error)}))])})).catch((function(){})).then((function(){return e.broadcastChannel.removeEventListener("internal",o),!r&&function(t){t.isLeader=!0,t.hasLeader=!0;var e=Ke((function(){return t.die()}));t._unl.push(e);var n=function(e){"leader"===e.context&&"apply"===e.action&&Ge(t,"tell"),"leader"!==e.context||"tell"!==e.action||t._dpLC||(t._dpLC=!0,t._dpL(),Ge(t,"tell"))};return t.broadcastChannel.addEventListener("internal",n),t._lstns.push(n),Ge(t,"tell")}(e).then((function(){return!0}))}))};return this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then((function(){return n()})).then((function(){e._aplQC=e._aplQC-1})),this._aplQ.then((function(){return e.isLeader}))},awaitLeadership:function(){return this._aLP||(this._aLP=function(t){if(t.isLeader)return ue;return new Promise((function(e){var n=!1;function r(){n||(n=!0,t.broadcastChannel.removeEventListener("internal",i),e(!0))}t.applyOnce().then((function(){t.isLeader&&r()})),function e(){return ce(t._options.fallbackInterval).then((function(){if(!t.isDead&&!n)return t.isLeader?void r():t.applyOnce(!0).then((function(){t.isLeader?r():e()}))}))}();var i=function(e){"leader"===e.context&&"death"===e.action&&(t.hasLeader=!1,t.applyOnce().then((function(){t.isLeader&&r()})))};t.broadcastChannel.addEventListener("internal",i),t._lstns.push(i)}))}(this)),this._aLP},set onduplicate(t){this._dpL=t},die:function(){var t=this;return this._lstns.forEach((function(e){return t.broadcastChannel.removeEventListener("internal",e)})),this._lstns=[],this._unl.forEach((function(t){return t.remove()})),this._unl=[],this.isLeader&&(this.hasLeader=!1,this.isLeader=!1),this.isDead=!0,Ge(this,"death")}};var Ye=new Map;function Xe(t,e,n){var r=Ye.get(t);return r||(r={bc:new $e("RxDB:"+e),refs:new Set},Ye.set(t,r)),r.refs.add(n),r.bc}function Ze(t,e){var n=Ye.get(t);if(n)return n.refs.delete(e),0===n.refs.size?(Ye.delete(t),n.bc.close()):void 0}function tn(t,e,n,r){if(e.multiInstance){var i=r||Xe(e.databaseInstanceToken,n.databaseName,n),o=new H,s=function(n){n.storageName===t&&n.databaseName===e.databaseName&&n.collectionName===e.collectionName&&n.version===e.schema.version&&o.next(n.eventBulk)};i.addEventListener("message",s);var u=n.changeStream(),l=!1,h=u.subscribe((function(n){l||i.postMessage({storageName:t,databaseName:e.databaseName,collectionName:e.collectionName,version:e.schema.version,eventBulk:n})}));n.changeStream=function(){return o.asObservable().pipe(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return se.apply(void 0,v([],y(t)))}(u))};var f=n.close.bind(n);n.close=a(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l=!0,h.unsubscribe(),i.removeEventListener("message",s),r){t.next=6;break}return t.next=6,Ze(e.databaseInstanceToken,n);case 6:return t.abrupt("return",f());case 7:case"end":return t.stop()}}),t)})));var d=n.remove.bind(n);n.remove=a(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l=!0,h.unsubscribe(),i.removeEventListener("message",s),r){t.next=6;break}return t.next=6,Ze(e.databaseInstanceToken,n);case 6:return t.abrupt("return",d());case 7:case"end":return t.stop()}}),t)})))}}new WeakMap;var en=new WeakMap;function nn(t){var e=en.get(t);return e||(e=He(t),en.set(t,e)),e}var rn="rxdb-lokijs-remote-request",on="rxdb-lokijs-remote-request-key-object",sn="lokijs";function an(t){if(!t.$loki)return t;var e=r(t);return e.$lastWriteAt&&(e._meta={lwt:e.$lastWriteAt},delete e.$lastWriteAt),delete e.$loki,e}var un=new Set,cn={disableChangesApi:!0,disableMeta:!0,disableDeltaChangesApi:!0,disableFreeze:!0,cloneMethod:"shallow-assign",clone:!1,transactional:!1,autoupdate:!1},ln=new Map;function hn(t,n){var i=ln.get(t);if(!i){var o=!!n.adapter;i=a(c().mark((function i(){var s,a,u,l,h,f,d;return c().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=o?"adapter":"memory",n.persistenceMethod&&(s=n.persistenceMethod),a=Object.assign({autoload:o,persistenceMethod:s,verbose:!0},n,{autoload:!1,autosave:!1,throttledSaves:!1}),u=new(e())(t+".db",r(a)),l=new _t(u,a),!o){i.next=10;break}return h=new Promise((function(t,e){try{u.loadDatabase({recursiveWait:!1},(function(n){a.autoloadCallback&&a.autoloadCallback(n),n?e(n):t()}))}catch(t){e(t)}})),l.saveQueue=l.saveQueue.then((function(){return h})),i.next=10,h;case 10:return f=[],o&&f.push(St((function(){return l.run()}))),d={database:u,databaseSettings:a,saveQueue:l,collections:{},unloads:f},i.abrupt("return",d);case 14:case"end":return i.stop()}}),i)})))(),ln.set(t,i)}return i}function fn(t,e){return dn.apply(this,arguments)}function dn(){return(dn=a(c().mark((function t(e,n){var r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ln.get(e);case 2:if(r=t.sent){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,r.saveQueue.run();case 7:if(n.forEach((function(t){var e=t.name;delete r.collections[e]})),0!==Object.keys(r.collections).length){t.next=13;break}return ln.delete(e),r.unloads.forEach((function(t){return t.remove()})),t.next=13,new Promise((function(t,e){r.database.close((function(n){n?e(n):t()}))}));case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function pn(t,e){if(!e.sort)throw yt("SNH",{query:e});var n=e.sort;return function(t,r){var i=0;if(n.find((function(e){var n=Object.keys(e)[0],o="asc"===Object.values(e)[0]?1:-1,s=At().get(t,n),a=At().get(r,n);return s!==a&&(s>a?(i=1*o,!0):(i=-1*o,!0))})),!i)throw yt("SNH",{args:{query:e,a:t,b:r}});return i}}function yn(t,e,n){return nn(Xe(t,n,e))}function vn(t,e,n){return mn.apply(this,arguments)}function mn(){return(mn=a(c().mark((function t(e,n,r){var o,s,a,u,l,h,f,d,p;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o="function"==typeof e.query,s=o?rn:on,a=i(e.internals.leaderElector),t.next=5,gn(a);case 5:return u=a.broadcastChannel,h=new Promise((function(t){l=function(e){"leader"===e.context&&"death"===e.action&&t({retry:!0})},u.addEventListener("internal",l)})),f=Pt(12),p=new Promise((function(t,e){d=function(e){e.type===s&&!0===e.response&&e.requestId===f&&(e.isError?t({retry:!1,error:e.result}):t({retry:!1,result:e.result}))},u.addEventListener("message",d)})),u.postMessage({response:!1,type:s,operation:n,params:r,requestId:f,databaseName:e.databaseName,collectionName:e.collectionName}),t.abrupt("return",Promise.race([h,p]).then((function(t){var i;if(u.removeEventListener("message",d),u.removeEventListener("internal",l),t.retry)return(i=e)[n].apply(i,r);if(t.error)throw t.error;return t.result})));case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function bn(){return(bn=a(c().mark((function t(e,n){var r,o,s,a,u,l;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.type!==rn||!n.requestId||n.databaseName!==e.databaseName||n.collectionName!==e.collectionName||n.response){t.next=17;break}return r=n.operation,o=n.params,a=!1,t.prev=4,t.next=7,(u=e)[r].apply(u,o);case 7:s=t.sent,t.next=15;break;case 10:t.prev=10,t.t0=t.catch(4),console.dir(t.t0),a=!0,s=t.t0;case 15:l={response:!0,requestId:n.requestId,databaseName:e.databaseName,collectionName:e.collectionName,result:s,isError:a,type:n.type},i(e.internals.leaderElector).broadcastChannel.postMessage(l);case 17:case"end":return t.stop()}}),t,null,[[4,10]])})))).apply(this,arguments)}function gn(t){return wn.apply(this,arguments)}function wn(){return(wn=a(c().mark((function t(e){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.hasLeader){t.next=7;break}return t.next=3,e.applyOnce();case 3:return t.next=5,Dt(0);case 5:t.next=0;break;case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function In(t){return kn.apply(this,arguments)}function kn(){return(kn=a(c().mark((function t(e){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.closed){t.next=2;break}throw yt("SNH",{args:{instanceClosed:e.closed,databaseName:e.databaseName,collectionName:e.collectionName}});case 2:if(!e.internals.localState){t.next=4;break}return t.abrupt("return",e.internals.localState);case 4:return n=i(e.internals.leaderElector),t.next=7,gn(n);case 7:if(!e.internals.localState){t.next=9;break}return t.abrupt("return",e.internals.localState);case 9:if(!n.isLeader||e.internals.localState){t.next=14;break}return e.internals.localState=An({databaseInstanceToken:e.databaseInstanceToken,databaseName:e.databaseName,collectionName:e.collectionName,options:e.options,schema:e.schema,multiInstance:!!e.internals.leaderElector},e.databaseSettings),t.abrupt("return",i(e.internals.localState));case 14:return t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function xn(t){return"string"==typeof t?t:t.key}function Sn(t){return function(t,e){var n,r,i,o=0;if("undefined"==typeof TextEncoder||e){i=[];for(var s=0;s<t.length;s++)i.push(t.charCodeAt(s))}else i=(new TextEncoder).encode(t);for(n=0,r=t.length;n<r;n++)o=(o<<5)-o+i[n],o|=0;return o<0&&(o*=-1),o.toString(36)}(t)}function On(t,e){var n=null;return e.forEach((function(e){(!n||e._meta.lwt>n._meta.lwt||e._meta.lwt===n._meta.lwt&&e[t]>n[t])&&(n=e)})),i(n)}function Pn(t,e,n,r,o){var s=!!t.schema.attachments,a=[],u=[],c={},l=[],h={id:Pt(10),events:[],checkpoint:null,context:o},f=[],d=[],p=[],y=Z(),v="function"==typeof n.get;return r.forEach((function(r){var o,m=r.document[e],b=v?n.get(m):n[m];if(b){var g=b._rev;if(!r.previous||r.previous&&g!==r.previous._rev){var w={isError:!0,status:409,documentId:m,writeRow:r,documentInDb:b};return void(c[m]=w)}var I=s?Dn(r):r;r.document._deleted?r.previous&&Object.keys(r.previous._attachments).forEach((function(t){d.push({documentId:m,attachmentId:t})})):(Object.entries(r.document._attachments).find((function(t){var e=t[0],n=t[1];return(r.previous?r.previous._attachments[e]:void 0)||n.data||(o={documentId:m,documentInDb:b,isError:!0,status:510,writeRow:r,attachmentId:e}),!0})),o||Object.entries(r.document._attachments).forEach((function(t){var e=t[0],n=t[1],i=r.previous?r.previous._attachments[e]:void 0;if(i){var o=I.document._attachments[e].digest;n.data&&i.digest!==o&&p.push({documentId:m,attachmentId:e,attachmentData:n})}else f.push({documentId:m,attachmentId:e,attachmentData:n})}))),o?c[m]=o:u.push(I);var k=r.document,x=null,S=null,O=null;if(r.previous&&r.previous._deleted&&!k._deleted)O="INSERT",x=s?En(k):k;else if(!r.previous||r.previous._deleted||k._deleted){if(!k._deleted)throw yt("SNH",{args:{writeRow:r}});O="DELETE",x=i(r.document),S=r.previous}else O="UPDATE",x=s?En(k):k,S=r.previous;l.push(m),h.events.push({eventId:Cn(t,e,r),documentId:m,documentData:i(x),previousDocumentData:S,operation:O,startTime:y,endTime:Z()})}else{var P=!!r.document._deleted;Object.entries(r.document._attachments).forEach((function(t){var e=t[0],n=t[1];n.data?f.push({documentId:m,attachmentId:e,attachmentData:n}):(o={documentId:m,isError:!0,status:510,writeRow:r,attachmentId:e},c[m]=o)})),o||(s?a.push(Dn(r)):a.push(r)),P||(l.push(m),h.events.push({eventId:Cn(t,e,r),documentId:m,operation:"INSERT",documentData:s?En(r.document):r.document,previousDocumentData:s&&r.previous?En(r.previous):r.previous,startTime:y,endTime:Z()}))}})),{bulkInsertDocs:a,bulkUpdateDocs:u,errors:c,changedDocumentIds:l,eventBulk:h,attachmentsAdd:f,attachmentsRemove:d,attachmentsUpdate:p}}function Dn(t){return{previous:t.previous,document:En(t.document)}}function En(t){var e=r(t);return e._attachments={},Object.entries(t._attachments).forEach((function(t){var n,r,i,o=t[0],s=t[1];e._attachments[o]=(i=(n=s).data)?{digest:Sn(i),length:(r=i,atob(r).length),type:n.type}:n})),e}function Cn(t,e,n){var r=n.document[e],i=[!!n.previous,n.previous&&n.previous._deleted,!!n.document._deleted].map((function(t){return t?"1":"0"})).join("");return t.databaseName+"|"+t.collectionName+"|"+r+"||"+i+"|"+n.document._rev}var _n=Z(),jn=function(){function t(t,e,n,r,o,s,a,u){var c=this;if(this.changes$=new H,this.instanceId=_n++,this.closed=!1,this.databaseInstanceToken=t,this.storage=e,this.databaseName=n,this.collectionName=r,this.schema=o,this.internals=s,this.options=a,this.databaseSettings=u,this.primaryPath=xn(this.schema.primaryKey),un.add(this),this.internals.leaderElector){var l={bulkWrite:this.bulkWrite.bind(this),changeStream:this.changeStream.bind(this),cleanup:this.cleanup.bind(this),close:this.close.bind(this),query:this.query.bind(this),count:this.count.bind(this),findDocumentsById:this.findDocumentsById.bind(this),collectionName:this.collectionName,databaseName:this.databaseName,conflictResultionTasks:this.conflictResultionTasks.bind(this),getAttachmentData:this.getAttachmentData.bind(this),getChangedDocumentsSince:this.getChangedDocumentsSince.bind(this),internals:this.internals,options:this.options,remove:this.remove.bind(this),resolveConflictResultionTask:this.resolveConflictResultionTask.bind(this),schema:this.schema};this.internals.leaderElector.awaitLeadership().then((function(){i(c.internals.leaderElector).broadcastChannel.addEventListener("message",(function(t){return function(t,e){return bn.apply(this,arguments)}(l,t)}))}))}}var e=t.prototype;return e.bulkWrite=function(){var t=a(c().mark((function t(e,n){var i,s,a,u,l,h,f=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.length){t.next=2;break}throw yt("P2",{args:{documentWrites:e}});case 2:return t.next=4,In(this);case 4:if(i=t.sent){t.next=7;break}return t.abrupt("return",vn(this,"bulkWrite",[e]));case 7:return s={success:{},error:{}},a=new Map,u=new Map,e.forEach((function(t){var e=t.document[f.primaryPath],n=i.collection.by(f.primaryPath,e);n&&(u.set(e,n),a.set(e,an(n)))})),l=Pn(this,this.primaryPath,a,e,n),s.error=l.errors,l.bulkInsertDocs.forEach((function(t){var e=t.document[f.primaryPath];i.collection.insert(r(t.document)),s.success[e]=t.document})),l.bulkUpdateDocs.forEach((function(t){var e=t.document[f.primaryPath],n=o(u,e),r=Object.assign({},t.document,{$loki:n.$loki});i.collection.update(r),s.success[e]=t.document})),i.databaseState.saveQueue.addWrite(),l.eventBulk.events.length>0&&(h=On(this.primaryPath,Object.values(s.success)),l.eventBulk.checkpoint={id:h[this.primaryPath],lwt:h._meta.lwt},this.changes$.next(l.eventBulk)),t.abrupt("return",s);case 18:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),e.findDocumentsById=function(){var t=a(c().mark((function t(e,n){var r,i,o=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,In(this);case 2:if(r=t.sent){t.next=5;break}return t.abrupt("return",vn(this,"findDocumentsById",[e,n]));case 5:return i={},e.forEach((function(t){var e=r.collection.by(o.primaryPath,t);!e||e._deleted&&!n||(i[t]=an(e))})),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),e.query=function(){var t=a(c().mark((function t(e){var n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,In(this);case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return",vn(this,"query",[e]));case 5:return r=n.collection.chain().find(e.selector),e.sort&&(r=r.sort(pn(this.schema,e))),e.skip&&(r=r.offset(e.skip)),e.limit&&(r=r.limit(e.limit)),i=r.data().map((function(t){return an(t)})),t.abrupt("return",{documents:i});case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),e.count=function(){var t=a(c().mark((function t(e){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.query(e);case 2:return n=t.sent,t.abrupt("return",{count:n.documents.length,mode:"fast"});case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),e.getAttachmentData=function(t,e){throw new Error("Attachments are not implemented in the lokijs RxStorage. Make a pull request.")},e.getChangedDocumentsSince=function(){var t=a(c().mark((function t(e,n){var r,i,o,s,a,u;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,In(this);case 2:if(r=t.sent){t.next=5;break}return t.abrupt("return",vn(this,"getChangedDocumentsSince",[e,n]));case 5:return i=n?n.lwt:1,o=r.collection.chain().find({"_meta.lwt":{$gte:i}}).sort(tt(this.primaryPath)),s=o.data(),a=s[0],n&&a&&a[this.primaryPath]===n.id&&a._meta.lwt===n.lwt&&s.shift(),s=s.slice(0,e),u=(c=s)[c.length-1],t.abrupt("return",{documents:s.map((function(t){return an(t)})),checkpoint:u?{id:u[this.primaryPath],lwt:u._meta.lwt}:n||{id:"",lwt:0}});case 13:case"end":return t.stop()}var c}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),e.changeStream=function(){return this.changes$.asObservable()},e.cleanup=function(){var t=a(c().mark((function t(e){var n,r,i,o;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,In(this);case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return",vn(this,"cleanup",[e]));case 5:return 10,r=Z()-e,i=n.collection.chain().find({_deleted:!0,"_meta.lwt":{$lt:r}}).limit(10),(o=i.data()).length>0&&(n.collection.remove(o),n.databaseState.saveQueue.addWrite()),t.abrupt("return",10!==o.length);case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),e.close=function(){var t=a(c().mark((function t(){var e,n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.closed){t.next=2;break}return t.abrupt("return",Promise.reject(new Error("already closed")));case 2:if(this.closed=!0,this.changes$.complete(),un.delete(this),!this.internals.localState){t.next=16;break}return t.next=8,this.internals.localState;case 8:return e=t.sent,t.next=11,hn(this.databaseName,this.databaseSettings);case 11:return n=t.sent,t.next=14,n.saveQueue.run();case 14:return t.next=16,fn(this.databaseName,[e.collection]);case 16:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e.remove=function(){var t=a(c().mark((function t(){var e;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,In(this);case 2:if(e=t.sent){t.next=5;break}return t.abrupt("return",vn(this,"remove",[]));case 5:return e.databaseState.database.removeCollection(e.collection.name),t.next=8,e.databaseState.saveQueue.run();case 8:return t.abrupt("return",this.close());case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e.conflictResultionTasks=function(){return new H},e.resolveConflictResultionTask=function(){var t=a(c().mark((function t(e){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t}();function An(t,e){return Mn.apply(this,arguments)}function Mn(){return(Mn=a(c().mark((function t(e,n){var r,i,o,s,a,u,l;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.options||(e.options={}),t.next=3,hn(e.databaseName,n);case 3:return r=t.sent,i=[],e.schema.indexes&&e.schema.indexes.forEach((function(t){et(t)||i.push(t)})),o=xn(e.schema.primaryKey),i.push(o),s=e.collectionName+"-"+e.schema.version,a=Object.assign({},s,{indices:i,unique:[o]},cn),u=r.database.addCollection(s,a),r.collections[e.collectionName]=u,l={databaseState:r,collection:u},t.abrupt("return",l);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ln(){return Ln=a(c().mark((function t(e,n,r){var o,s,a,u,l,h;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o={},s={},!n.multiInstance){t.next=7;break}a=yn(n.databaseInstanceToken,s,n.databaseName),o.leaderElector=a,t.next=10;break;case 7:return o.localState=An(n,r),t.next=10,o.localState;case 10:return u=new jn(n.databaseInstanceToken,e,n.databaseName,n.collectionName,n.schema,o,n.options,r),tn(sn,n,u,o.leaderElector?o.leaderElector.broadcastChannel:void 0),n.multiInstance&&(l=u.close.bind(u),u.close=function(){return Ze(n.databaseInstanceToken,s),l()},h=u.remove.bind(u),u.remove=function(){return Ze(n.databaseInstanceToken,s),h()},i(o.leaderElector).awaitLeadership().then((function(){u.closed||In(u)}))),t.abrupt("return",u);case 14:case"end":return t.stop()}}),t)}))),Ln.apply(this,arguments)}var zn={prepareQuery:function(t,e){return e=r(e),Object.keys(i(e.selector)).length>0?e.selector={$and:[{_deleted:!1},e.selector]}:e.selector={_deleted:!1},e},getSortComparator:function(t,e){return pn(0,e)},getQueryMatcher:function(t,n){return function(t){if(t._deleted)return!1;var i=r(t);i._deleted=!!i._deleted;var o={data:[i],binaryIndices:{}};Object.setPrototypeOf(o,e().Collection.prototype);var s={collection:o};return Object.setPrototypeOf(s,e().Resultset.prototype),s.find(n.selector,!0),s.filteredrows.length>0}},checkpointSchema:{type:"object",properties:{id:{type:"string"},lwt:{type:"number"}},required:["id","lwt"],additionalProperties:!1}},Nn=function(){function t(t){this.name=sn,this.statics=zn,this.leaderElectorByLokiDbName=new Map,this.databaseSettings=t}return t.prototype.createStorageInstance=function(t){return function(t){if(t.schema.keyCompression)throw yt("UT5",{args:{params:t}});if((e=t.schema).encrypted&&e.encrypted.length>0||e.attachments&&e.attachments.encrypted)throw yt("UT6",{args:{params:t}});var e}(t),function(t,e,n){return Ln.apply(this,arguments)}(this,t,this.databaseSettings)},t}();var Tn=n(1934);const $n=Tn.expose;Tn.registerSerializer,Tn.Transfer;var qn,Bn,Fn,Rn,Vn,Wn=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new Nn(t);return e}({adapter:new(n(8930))});qn={storage:Wn},Fn=0,Rn=new Map,Vn={createStorageInstance:(Bn=a(c().mark((function t(e){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Fn++,t.next=3,qn.storage.createStorageInstance(e);case 3:return r=t.sent,Rn.set(n,r),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)}))),function(t){return Bn.apply(this,arguments)}),bulkWrite:function(t,e,n){return o(Rn,t).bulkWrite(e,n)},findDocumentsById:function(t,e,n){return o(Rn,t).findDocumentsById(e,n)},query:function(t,e){return o(Rn,t).query(e)},count:function(t,e){return o(Rn,t).count(e)},getAttachmentData:function(t,e,n){return o(Rn,t).getAttachmentData(e,n)},getChangedDocumentsSince:function(t,e,n){return o(Rn,t).getChangedDocumentsSince(e,n)},changeStream:function(t){return o(Rn,t).changeStream()},cleanup:function(t,e){return o(Rn,t).cleanup(e)},close:function(t){return o(Rn,t).close()},remove:function(t){return o(Rn,t).remove()},conflictResultionTasks:function(t){return o(Rn,t).conflictResultionTasks()},resolveConflictResultionTask:function(t,e){return o(Rn,t).resolveConflictResultionTask(e)}},$n(Vn)})()})();
//# sourceMappingURL=lokijs-incremental-indexeddb.worker.js.map